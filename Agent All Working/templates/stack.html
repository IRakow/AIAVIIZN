
{% extends 'base.html' %}

{% block title %}AppFolio Stackâ„¢ Marketplace - AppFolio Property Manager{% endblock %}

{% block extra_css %}
<style>
    :root {
        --appfolio-primary: #2563eb;
        --appfolio-secondary: #64748b;
        --appfolio-success: #10b981;
        --appfolio-warning: #f59e0b;
        --appfolio-danger: #ef4444;
        --appfolio-light: #f8fafc;
        --appfolio-dark: #1e293b;
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .content-wrapper {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    .content-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        pointer-events: none;
    }

    .main-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        margin: 2rem auto;
        box-shadow: var(--shadow-xl);
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        z-index: 1;
    }

    .marketplace-header {
        background: var(--gradient-primary);
        color: white;
        padding: 2rem;
        border-radius: 20px 20px 0 0;
        margin: -1rem -1rem 2rem -1rem;
        position: relative;
        overflow: hidden;
    }

    .marketplace-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: float 6s ease-in-out infinite;
    }

    .marketplace-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .feedback-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        backdrop-filter: blur(10px);
        border-radius: 50px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
    }

    .feedback-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .info-section {
        background: var(--appfolio-light);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(0,0,0,0.05);
        position: relative;
        overflow: hidden;
    }

    .info-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-primary);
    }

    .clickable-header {
        cursor: pointer;
        padding: 1rem;
        border-radius: 10px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(0,0,0,0.1);
    }

    .clickable-header:hover {
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }

    .clickable-header h2 {
        color: var(--appfolio-dark);
        font-weight: 600;
        margin: 0;
    }

    .chevron-icon {
        transition: transform 0.3s ease;
        color: var(--appfolio-primary);
    }

    .clickable-header[aria-expanded="true"] .chevron-icon {
        transform: rotate(180deg);
    }

    .collapse-content {
        padding: 2rem 1rem 0;
        animation: slideDown 0.3s ease;
    }

    .partner-type-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid rgba(0,0,0,0.05);
        height: 100%;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .partner-type-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-secondary);
    }

    .partner-type-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-xl);
    }

    .partner-type-card h4 {
        color: var(--appfolio-dark);
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .badge-modern {
        background: var(--gradient-primary);
        color: white;
        border-radius: 20px;
        padding: 0.5rem 1rem;
        font-weight: 600;
        font-size: 0.875rem;
        display: inline-block;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .filters-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid rgba(0,0,0,0.05);
    }

    .filter-group {
        margin-bottom: 1.5rem;
    }

    .filter-label {
        font-size: 1rem;
        font-weight: 600;
        color: var(--appfolio-dark);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .help-icon {
        color: var(--appfolio-primary);
        font-size: 1.1rem;
        transition: all 0.3s ease;
    }

    .help-icon:hover {
        color: var(--appfolio-secondary);
        transform: scale(1.1);
    }

    .form-control-modern {
        border: 2px solid rgba(0,0,0,0.1);
        border-radius: 10px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
    }

    .form-control-modern:focus {
        border-color: var(--appfolio-primary);
        box-shadow: 0 0 0 0.25rem rgba(37, 99, 235, 0.15);
        background: white;
        transform: translateY(-1px);
    }

    .dropdown-menu-modern {
        border: none;
        border-radius: 15px;
        box-shadow: var(--shadow-xl);
        border: 1px solid rgba(0,0,0,0.1);
        padding: 1rem;
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.95);
    }

    .dropdown-item-modern {
        border-radius: 8px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.25rem;
        transition: all 0.3s ease;
        border: 1px solid transparent;
    }

    .dropdown-item-modern:hover {
        background: var(--gradient-primary);
        color: white;
        transform: translateX(5px);
    }

    .dropdown-header-modern {
        font-weight: 700;
        color: var(--appfolio-primary);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
        padding: 0.5rem 1rem;
    }

    .ai-enhanced {
        position: relative;
        overflow: hidden;
    }

    .ai-enhanced::before {
        content: 'ðŸ¤– AI Enhanced';
        position: absolute;
        top: -2px;
        right: -2px;
        background: var(--gradient-secondary);
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 0 8px 0 8px;
        z-index: 10;
    }

    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }

    .profile-form {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        margin-bottom: 2rem;
        border: 1px solid rgba(0,0,0,0.05);
    }

    .btn-primary-modern {
        background: var(--gradient-primary);
        border: none;
        border-radius: 10px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-primary-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        background: var(--gradient-primary);
    }

    .btn-secondary-modern {
        background: var(--appfolio-secondary);
        border: none;
        border-radius: 10px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-secondary-modern:hover {
        background: var(--appfolio-dark);
        transform: translateY(-2px);
    }

    .error-message {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--appfolio-danger);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
        animation: shake 0.5s ease-in-out;
    }

    .success-message {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: var(--appfolio-success);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
        animation: slideDown 0.3s ease;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .fade-in {
        animation: slideDown 0.6s ease;
    }

    @media (max-width: 768px) {
        .marketplace-header h1 {
            font-size: 1.75rem;
        }

        .main-container {
            margin: 1rem;
            border-radius: 15px;
        }

        .marketplace-header {
            border-radius: 15px 15px 0 0;
        }

        .filters-section {
            padding: 1rem;
        }

        .partner-type-card {
            margin-bottom: 1rem;
        }
    }

    .tooltip-modern {
        background: var(--appfolio-dark);
        color: white;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        box-shadow: var(--shadow-lg);
    }

    .focus-areas-grid {
        max-height: 300px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--appfolio-primary) var(--appfolio-light);
    }

    .focus-areas-grid::-webkit-scrollbar {
        width: 6px;
    }

    .focus-areas-grid::-webkit-scrollbar-track {
        background: var(--appfolio-light);
        border-radius: 3px;
    }

    .focus-areas-grid::-webkit-scrollbar-thumb {
        background: var(--appfolio-primary);
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div id="content" class="content-wrapper position-fixed bottom-0 overflow-y-auto js-main-page partner_connections index">
    <main class="main-container mx-auto px-4 w-100">
        <section class="js-page-content-body page__content-body page-content-body px-2 py-4 fade-in">
            
            <!-- Flash Messages -->
            <div id="flash_messages">
                <!-- Success/Error messages will be dynamically inserted here -->
            </div>

            <!-- Profile Form -->
            <div class="profile-form ai-enhanced">
                <h3 class="mb-3 text-primary"><i class="fas fa-user-cog me-2"></i>Profile Settings</h3>
                <form id="profileForm" action="{{ url_for('user_profiles.switch') }}" method="post" class="row g-3">
                    <input type="hidden" name="_method" value="put">
                    <input type="hidden" name="authenticity_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="from_page_action" value="partner_connections-index">
                    
                    <div class="col-md-6">
                        <label for="profile_profile_name" class="form-label filter-label">
                            <i class="fas fa-building me-1"></i>Selected Profile
                            <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Choose your management profile type"></i>
                        </label>
                        <select name="profile[profile_name]" id="profile_profile_name" class="form-select form-control-modern" required>
                            <option value="property_management" selected>Property Management</option>
                            <option value="association_management">Association Management</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 d-flex align-items-end">
                        <button type="submit" id="switch_profile_button" class="btn btn-primary-modern me-2">
                            <i class="fas fa-sync-alt me-2"></i>Switch Profile
                            <span class="loading-spinner d-none"></span>
                        </button>
                        <button type="button" class="btn btn-secondary-modern" onclick="resetForm()">
                            <i class="fas fa-times me-2"></i>Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Main Content -->
            <div id="partner_connections_main" data-env="production">
                <div id="app" class="mt-4">
                    
                    <!-- Header -->
                    <div class="marketplace-header">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <h1><i class="fas fa-store me-3"></i>AppFolio Stackâ„¢ Marketplace</h1>
                                <p class="mb-0 opacity-90">Discover and connect with powerful integrations for your property management needs</p>
                            </div>
                            <button type="button" class="feedback-btn js-no-autofocus" onclick="openFeedback()">
                                <i class="fa-solid fa-envelope me-2"></i>Feedback
                            </button>
                        </div>
                    </div>

                    <!-- How it works section -->
                    <section class="info-section my-4">
                        <header>
                            <div class="clickable-header" role="button" aria-expanded="false" onclick="toggleSection(this)" data-bs-toggle="collapse" data-bs-target="#howItWorks">
                                <div class="d-flex align-items-center">
                                    <i class="fa-solid fa-chevron-down fa-fw chevron-icon me-2"></i>
                                    <h2>"How does this work?"</h2>
                                </div>
                            </div>
                        </header>
                        
                        <div class="collapse" id="howItWorks">
                            <div class="collapse-content">
                                <div class="row">
                                    <div class="col-xl-6">
                                        <p class="lead mb-3">The version of AppFolio Property Manager you're on determines which partners are available for your use.</p>
                                        <ul class="list-unstyled">
                                            <li class="mb-3">
                                                <i class="fas fa-check-circle text-success me-2"></i>
                                                <strong>Your business has purchased: AppFolio Property Manager Core</strong>
                                            </li>
                                            <li class="mb-3">
                                                <i class="fas fa-star text-warning me-2"></i>
                                                You can use all the partners listed on this page, some of which (those marked as Premium) involve additional charges from AppFolio.
                                                <a href="https://help.appfolio.com/s/article/AppFolio-Stack-Premium" target="_blank" rel="noreferrer" class="ms-2 text-decoration-none">
                                                    Learn More <i class="fas fa-external-link-alt"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="partner-type-card h-100">
                                            <h4><i class="fas fa-puzzle-piece me-2 text-primary"></i>The Types of Partners Available</h4>
                                            
                                            <div class="mb-4">
                                                <span class="badge-modern">App</span>
                                                <p class="mt-2">App Partners offer software applications that we've integrated with so you can sync your data between AppFolio Property Manager and their application.</p>
                                            </div>
                                            
                                            <div>
                                                <span class="badge-modern">Solution</span>
                                                <p class="mt-2">Solution Partners offer advisory and managed services so you can get whatever help you need.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Filters Section -->
                    <div class="filters-section">
                        <h3 class="mb-4 text-primary"><i class="fas fa-filter me-2"></i>Filter Partners</h3>
                        <div class="row g-4">
                            
                            <!-- Partner Type Filter -->
                            <div class="col-lg-4">
                                <div class="filter-group ai-enhanced">
                                    <div class="filter-label">
                                        Partner Type / Status:
                                        <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Filter by partner type and connection status"></i>
                                    </div>
                                    
                                    <div class="dropdown">
                                        <input type="text" class="form-control form-control-modern dropdown-toggle" 
                                               id="partnerTypeFilter" data-bs-toggle="dropdown" 
                                               value="All Partners" readonly>
                                        <ul class="dropdown-menu dropdown-menu-modern w-100">
                                            <li><h6 class="dropdown-header-modern">Default</h6></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">All Partners</a></li>
                                            
                                            <li><hr class="dropdown-divider"></li>
                                            <li><h6 class="dropdown-header-modern">Partner Tiers</h6></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">Premium Partners</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">Standard Partners</a></li>
                                            
                                            <li><hr class="dropdown-divider"></li>
                                            <li><h6 class="dropdown-header-modern">Partner Types</h6></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">App Partners</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">Solution Partners</a></li>
                                            
                                            <li><hr class="dropdown-divider"></li>
                                            <li><h6 class="dropdown-header-modern">Connection Status</h6></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'partnerTypeFilter')">Connected</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Category Filter -->
                            <div class="col-lg-4">
                                <div class="filter-group">
                                    <div class="filter-label">
                                        Category:
                                        <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Filter by business category"></i>
                                    </div>
                                    
                                    <div class="dropdown">
                                        <input type="text" class="form-control form-control-modern dropdown-toggle" 
                                               id="categoryFilter" data-bs-toggle="dropdown" 
                                               placeholder="Click to select an option..." readonly>
                                        <ul class="dropdown-menu dropdown-menu-modern w-100">
                                            <li class="p-2">
                                                <input type="text" class="form-control" placeholder="Search categories..." id="categorySearch">
                                            </li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Accounting & Reporting</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Compliance</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Construction Management</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Consulting</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Delinquencies</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Inspections</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">IoT & Smart Properties</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Mailing Service</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Maintenance</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Marketing & Leasing</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Package Delivery / Management</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Resident App</a></li>
                                            <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'categoryFilter')">Utility Management</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Focus Areas Filter -->
                            <div class="col-lg-4">
                                <div class="filter-group">
                                    <div class="filter-label">
                                        Focus Areas:
                                        <i class="fas fa-info-circle help-icon" data-bs-toggle="tooltip" title="Filter by specific focus areas"></i>
                                    </div>
                                    
                                    <div class="dropdown">
                                        <input type="text" class="form-control form-control-modern dropdown-toggle" 
                                               id="focusAreasFilter" data-bs-toggle="dropdown" 
                                               placeholder="Click to select an option..." readonly>
                                        <ul class="dropdown-menu dropdown-menu-modern w-100">
                                            <li class="p-2">
                                                <input type="text" class="form-control" placeholder="Search focus areas..." id="focusAreasSearch">
                                            </li>
                                            <div class="focus-areas-grid">
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">3D Home Tours</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Access Control</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Accounts Payable</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Accounts Receivable/Payable</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Affordable Housing Compliance Consulting</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Affordable Housing Compliance Monitoring</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">AI-Powered Coaching</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">AI-Powered Diagnosis</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Bank Reconciliations</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Bookkeeping</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Business Operations</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Collections</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">CRM</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Custom Software Integrations</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Evictions</a></li>
                                                <li><a class="dropdown-item dropdown-item-modern" href="#" onclick="selectFilter(this, 'focusAreasFilter')">Floor Plans</a></li>
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <button type="button" class="btn btn-primary-modern me-2" onclick="applyFilters()">
                                    <i class="fas fa-search me-2"></i>Apply Filters
                                </button>
                                <button type="button" class="btn btn-secondary-modern" onclick="clearFilters()">
                                    <i class="fas fa-times me-2"></i>Clear All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Partners Grid (placeholder for dynamic content) -->
                    <div id="partnersGrid" class="mt-4">
                        <div class="text-center py-5">
                            <div class="loading-spinner mb-3" style="width: 40px; height: 40px; border-width: 4px;"></div>
                            <p class="text-muted">Loading partners...</p>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Load partners data
    loadPartners();

    // Initialize search filters
    setupSearchFilters();
});

// Toggle section functionality
function toggleSection(element) {
    const chevron = element.querySelector('.chevron-icon');
    const isExpanded = element.getAttribute('aria-expanded') === 'true';
    
    element.setAttribute('aria-expanded', !isExpanded);
    
    if (isExpanded) {
        chevron.style.transform = 'rotate(0deg)';
    } else {
        chevron.style.transform = 'rotate(180deg)';
    }
}

// Filter selection
function selectFilter(element, filterId) {
    const filterInput = document.getElementById(filterId);
    filterInput.value = element.textContent.trim();
    
    // Close dropdown
    const dropdown = bootstrap.Dropdown.getInstance(filterInput);
    if (dropdown) dropdown.hide();
}

// Setup search functionality for dropdowns
function setupSearchFilters() {
    const categorySearch = document.getElementById('categorySearch');
    const focusAreasSearch = document.getElementById('focusAreasSearch');
    
    if (categorySearch) {
        categorySearch.addEventListener('input', function(e) {
            filterDropdownItems(e.target, 'categoryFilter');
        });
    }
    
    if (focusAreasSearch) {
        focusAreasSearch.addEventListener('input', function(e) {
            filterDropdownItems(e.target, 'focusAreasFilter');
        });
    }
}

// Filter dropdown items based on search
function filterDropdownItems(searchInput, filterId) {
    const searchTerm = searchInput.value.toLowerCase();
    const dropdown = searchInput.closest('.dropdown-menu');
    const items = dropdown.querySelectorAll('.dropdown-item-modern');
    
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

// Profile form submission
document.getElementById('profileForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('switch_profile_button');
    const spinner = submitBtn.querySelector('.loading-spinner');
    
    // Show loading state
    submitBtn.disabled = true;
    spinner.classList.remove('d-none');
    
    // Simulate form submission (replace with actual AJAX call)
    setTimeout(() => {
        // Reset loading state
        submitBtn.disabled = false;
        spinner.classList.add('d-none');
        
        // Show success message
        showMessage('Profile switched successfully!', 'success');
        
        // Reload partners with new profile
        loadPartners();
    }, 2000);
});

// Reset form
function resetForm() {
    const form = document.getElementById('profileForm');
    form.reset();
    
    // Reset to default selection
    document.getElementById('profile_profile_name').value = 'property_management';
}

// Apply filters
function applyFilters() {
    const partnerType = document.getElementById('partnerTypeFilter').value;
    const category = document.getElementById('categoryFilter').value;
    const focusAreas = document.getElementById('focusAreasFilter').value;
    
    // Show loading state
    document.getElementById('partnersGrid').innerHTML = `
        <div class="text-center py-5">
            <div class="loading-spinner mb-3" style="width: 40px; height: 40px; border-width: 4px;"></div>
            <p class="text-muted">Filtering partners...</p>
        </div>
    `;
    
    // Simulate filtering (replace with actual API call)
    setTimeout(() => {
        loadPartners({
            partnerType: partnerType !== 'All Partners' ? partnerType : null,
            category: category || null,
            focusAreas: focusAreas || null
        });
    }, 1500);
}

// Clear all filters
function clearFilters() {
    document.getElementById('partnerTypeFilter').value = 'All Partners';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('categoryFilter').placeholder = 'Click to select an option...';
    document.getElementById('focusAreasFilter').value = '';
    document.getElementById('focusAreasFilter').placeholder = 'Click to select an option...';
    
    loadPartners();
}

// Load partners data
async function loadPartners(filters = {}) {
    try {
        // This would be replaced with actual Supabase integration
        const partnersGrid = document.getElementById('partnersGrid');
        
        // Simulate loading
        setTimeout(() => {
            partnersGrid.innerHTML = `
                <div class="row g-4">
                    <div class="col-12">
                        <h3 class="text-primary mb-4"><i class="fas fa-handshake me-2"></i>Available Partners</h3>
                    </div>
                    
                    <!-- Example partner cards -->
                    <div class="col-md-6 col-lg-4">
                        <div class="partner-type-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge-modern">App</span>
                                <span class="badge bg-success">Premium</span>
                            </div>
                            <h5>Property Management Pro</h5>
                            <p class="text-muted">Advanced property management tools with AI-powered insights and automated workflows.</p>
                            <div class="mb-3">
                                <small class="text-muted">Category: Property Management</small><br>
                                <small class="text-muted">Focus: AI-Powered Coaching, CRM</small>
                            </div>
                            <button class="btn btn-primary-modern w-100">Connect</button>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="partner-type-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge-modern">Solution</span>
                                <span class="badge bg-info">Standard</span>
                            </div>
                            <h5>Maintenance Masters</h5>
                            <p class="text-muted">Complete maintenance management solutions with 24/7 support and vendor coordination.</p>
                            <div class="mb-3">
                                <small class="text-muted">Category: Maintenance</small><br>
                                <small class="text-muted">Focus: Business Operations</small>
                            </div>
                            <button class="btn btn-primary-modern w-100">Learn More</button>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="partner-type-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge-modern">App</span>
                                <span class="badge bg-warning">Premium</span>
                            </div>
                            <h5>Smart Property IoT</h5>
                            <p class="text-muted">Internet of Things solutions for smart property management and monitoring systems.</p>
                            <div class="mb-3">
                                <small class="text-muted">Category: IoT & Smart Properties</small><br>
                                <small class="text-muted">Focus: Access Control, Utility Management</small>
                            </div>
                            <button class="btn btn-success w-100">
                                <i class="fas fa-check me-2"></i>Connected
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }, 1000);
        
    } catch (error) {
        console.error('Error loading partners:', error);
        showMessage('Error loading partners. Please try again.', 'error');
    }
}

// Show messages
function showMessage(message, type = 'info') {
    const flashMessages = document.getElementById('flash_messages');
    const alertClass = type === 'success' ? 'success-message' : 'error-message';
    
    flashMessages.innerHTML = `
        <div class="${alertClass}">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
            ${message}
        </div>
    `;
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        flashMessages.innerHTML = '';
    }, 5000);
}

// Open feedback modal
function openFeedback() {
    // This would open a feedback modal or redirect to feedback form
    showMessage('Feedback form would open here. Feature coming soon!', 'info');
}

// Supabase integration functions
async function initSupabase() {
    // Initialize Supabase client
    // This would be implemented with actual Supabase credentials
}

async function fetchPartnersFromSupabase(filters = {}) {
    // Fetch partners data from Supabase
    // This would implement actual Supabase queries
}

async function updatePartnerConnection(partnerId, connectionStatus) {
    // Update partner connection status in Supabase
    // This would implement actual Supabase updates
}
</script>
{% endblock %}
