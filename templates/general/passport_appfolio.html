<!-- AIVIIZN Template: Passport | AppFolio -->
<!-- Generated from: https://celticprop.appfolio.com/help/login -->
<!-- Timestamp: 20250821_013941 -->
<!-- Beautiful AppFolio-inspired design -->

{% extends "base.html" %}

{% block title %}Passport | AppFolio - AIVIIZN Property Manager{% endblock %}

{% block styles %}
<style>
/* AppFolio-inspired styling converted for AIVIIZN */

/* AppFolio-inspired color scheme */
:root {
    --appfolio-blue: #0066CC;
    --appfolio-dark-blue: #0052A3;
    --appfolio-light-blue: #4A90E2;
    --appfolio-gray: #F8F9FA;
    --appfolio-border: #E0E6ED;
}

/* AppFolio-style navigation */
.aiviizn-nav {
    background: var(--appfolio-blue);
    border-bottom: 2px solid var(--appfolio-dark-blue);
}

/* AppFolio-style content areas */
.aiviizn-content {
    background: white;
    border: 1px solid var(--appfolio-border);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

/* AppFolio-style data tables */
.aiviizn-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border: 1px solid var(--appfolio-border);
    border-radius: 6px;
    overflow: hidden;
}

.aiviizn-table th {
    background: var(--appfolio-gray);
    font-weight: 600;
    padding: 12px 15px;
    text-align: left;
    border-bottom: 2px solid var(--appfolio-border);
}

.aiviizn-table td {
    padding: 10px 15px;
    border-bottom: 1px solid #f0f0f0;
}

.aiviizn-table tr:hover {
    background: #f8f9fa;
}


/* Page-specific styling */


/* AIVIIZN Beautiful Enhancements */
.aiviizn-page {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

.content-wrapper {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin: 20px;
    padding: 30px;
    backdrop-filter: blur(10px);
}

.aiviizn-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
    color: white;
    padding: 25px 30px;
    border-radius: 8px 8px 0 0;
    margin: -30px -30px 30px -30px;
    position: relative;
    overflow: hidden;
}

.aiviizn-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
}

.aiviizn-header h1 {
    margin: 0;
    font-weight: 600;
    font-size: 1.8rem;
    position: relative;
    z-index: 1;
}

.aiviizn-header p {
    margin: 8px 0 0 0;
    opacity: 0.9;
    position: relative;
    z-index: 1;
}

/* Beautiful AppFolio-style buttons */
.btn-appfolio {
    background: linear-gradient(135deg, #0066CC 0%, #0052A3 100%);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 102, 204, 0.3);
    position: relative;
    overflow: hidden;
}

.btn-appfolio:hover {
    background: linear-gradient(135deg, #0052A3 0%, #004182 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 102, 204, 0.4);
}

.btn-appfolio:active {
    transform: translateY(0);
}

/* Beautiful data grid styling */
.data-grid {
    border: 1px solid #e0e6ed;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    background: white;
}

.data-grid th {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    padding: 15px 12px;
    text-align: left;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #495057;
}

.data-grid td {
    padding: 12px;
    border-bottom: 1px solid #f8f9fa;
    vertical-align: middle;
    font-size: 14px;
}

.data-grid tr:hover {
    background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f4 100%);
    transition: all 0.2s ease;
}

.data-grid tr:last-child td {
    border-bottom: none;
}

/* Beautiful currency formatting */
.currency {
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    font-weight: 600;
    text-align: right;
    font-size: 14px;
}

.currency.positive {
    color: #28a745;
    background: rgba(40, 167, 69, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
}

.currency.negative {
    color: #dc3545;
    background: rgba(220, 53, 69, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
}

/* Beautiful form styling */
.aiviizn-form {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    margin: 20px 0;
}

.aiviizn-input {
    border: 2px solid #e9ecef;
    border-radius: 6px;
    padding: 10px 12px;
    font-size: 14px;
    transition: all 0.2s ease;
}

.aiviizn-input:focus {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(11, 83, 148, 0.1);
    outline: none;
}

/* Loading states */
.loading {
    opacity: 0.6;
    pointer-events: none;
    position: relative;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid var(--primary-blue);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design */
@media (max-width: 768px) {
    .content-wrapper {
        margin: 10px;
        padding: 20px;
    }
    
    .aiviizn-header {
        padding: 20px;
        margin: -20px -20px 20px -20px;
    }
    
    .data-grid {
        font-size: 12px;
    }
    
    .data-grid th,
    .data-grid td {
        padding: 8px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="aiviizn-page general">
    <div class="content-wrapper">
        <div class="aiviizn-header">
            <h1><i class="fas fa-chart-line me-3"></i>Passport | AppFolio</h1>
            <p class="mb-0">Professional property management reporting with beautiful design</p>
        </div>
        
        <!-- AppFolio Content Converted to Beautiful AIVIIZN Design -->
        <div class="aiviizn-content-area">
            <body><div id="root"><div class="aiviizn-container-fluid"><div class="aiviizn-row vh-md-100"><div class="aiviizn-col-md-5 col-sm-12 bg-primary d-flex justify-content-center align-items-center py-4"><img alt="AIVIIZN Logo" class="aiviizn-w-50 py-4" src="https://public.cdn.aiviizn.com/public/images/apm-secondary-white.svg"/></div><div class="aiviizn-col-md-7 col-sm-12 pt-4 px-4"><div class="aiviizn-PageContainer d-flex flex-nowrap m-sm-auto h-100 align-items-sm-center"><div class="aiviizn-Page"><h1 class="aiviizn-mb-4">Sign In</h1><form class="aiviizn-" novalidate=""><div class="aiviizn-form-group row mb-3"><label class="aiviizn-col-form-label-lg col-sm-12 col-form-label" for="usernameInput">Email</label><div class="aiviizn-col-12"><input autocomplete="off" class="aiviizn-aiviizn-input-lg aiviizn-input" id="usernameInput" name="username" placeholder="john.smith@email.com" type="email" value=""/></div></div><div class="aiviizn-form-group row mb-3"><label class="aiviizn-col-form-label-lg col-sm-12 col-form-label" for="passwordInput">Password</label><div class="aiviizn-col-12"><input class="aiviizn-aiviizn-input-lg aiviizn-input" id="passwordInput" name="password" type="password" value=""/></div></div><button class="aiviizn-p-3 w-100 mt-3 mb-3 btn btn-appfolio btn-lg" type="submit">Sign In</button></form><a href="/sign_in/forgot_password?idp_type=property&amp;vhostless=true">Forgot your password?</a><section class="aiviizn-py-5 text-center"><a aria-label="Get it on the Apple app store" href="https://itunes.apple.com/us/app/aiviizn-property-manager/id1057763031?mt=8" rel="noreferrer" target="_blank"><img alt="Get it on the Apple app store" src="https://pastage.cdn.aiviizn.com/aiviizn/images/badges/apple_store_badge.svg" width="120px"/></a><a aria-label="Get it on Google Play" href="https://play.google.com/store/apps/details?id=com.aiviizn.aiviizn_property_manager&amp;utm_source=passport_login" rel="noreferrer" target="_blank"><img alt="Get it on Google Play" src="https://pastage.cdn.aiviizn.com/aiviizn/images/badges/google_store_badge.svg" width="150px"/></a></section></div></div></div></div></div></div></body>
        </div>
        
        <!-- Interactive Forms with Beautiful Styling -->
        <div class="aiviizn-forms-section">
            <form class="aiviizn-form" class="" novalidate=""><div class="form-group row mb-3"><label class="col-form-label-lg col-sm-12 col-form-label" for="usernameInput">Email</label><div class="col-12"><input autocomplete="off" class="form-control-lg form-control" id="usernameInput" name="username" placeholder="john.smith@email.com" type="email" value=""/></div></div><div class="form-group row mb-3"><label class="col-form-label-lg col-sm-12 col-form-label" for="passwordInput">Password</label><div class="col-12"><input class="form-control-lg form-control" id="passwordInput" name="password" type="password" value=""/></div></div><button class="p-3 w-100 mt-3 mb-3 btn btn-primary btn-lg" type="submit">Sign In</button></form>

        </div>
        
        <!-- Data Visualization Section -->
        <div class="mt-4" id="data-visualization">
            <h3 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Data Insights</h3>
            <div class="row">
                <div class="col-md-8">
                    <canvas id="main-chart" style="max-height: 400px;"></canvas>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Quick Stats</h5>
                            <div id="quick-stats">
                                <!-- Stats will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Export and Action Buttons -->
        <div class="mt-4 d-flex justify-content-between align-items-center">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-appfolio" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf me-2"></i>Export PDF
                </button>
                <button type="button" class="btn btn-outline-primary" onclick="exportToExcel()">
                    <i class="fas fa-file-excel me-2"></i>Export Excel
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-2"></i>Refresh
                </button>
            </div>
            <small class="text-muted">
                Last updated: <span id="last-updated">{ page_data.timestamp }</span>
            </small>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chart.js for beautiful visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// AIVIIZN JavaScript - Beautiful AppFolio functionality
console.log('🚀 AIVIIZN Passport | AppFolio - Loading...');

// Supabase connection
const supabaseUrl = '{{ supabase_url }}';
const supabaseAnonKey = '{{ supabase_anon_key }}';
const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

// Page-specific calculations converted from AppFolio
// Extracted calculations from AppFolio


// Beautiful AIVIIZN Database Class
class AIVIIZNDatabase {
    constructor() {
        this.tableName = 'general_data';
        this.cache = new Map();
    }
    
    // Load data for this beautiful page
    async loadPageData() {
        try {
            console.log('📊 Loading data for Passport | AppFolio...');
            const { data, error } = await supabase
                .from(this.tableName)
                .select('*')
                .order('created_at', { ascending: false });
            
            if (error) throw error;
            
            this.cache.set('pageData', data);
            this.renderBeautifulData(data);
            this.updateCalculations(data);
            this.createVisualization(data);
            
            console.log('✅ Data loaded successfully!');
        } catch (error) {
            console.error('❌ Error loading data:', error);
            this.showErrorMessage('Failed to load data. Please try again.');
        }
    }
    
    // Render data in beautiful AppFolio-style tables
    renderBeautifulData(data) {
        const tableContainer = document.querySelector('.data-grid');
        if (!tableContainer || !data.length) return;
        
        // Create beautiful table HTML
        let tableHTML = '<table class="table table-hover data-grid">';
        
        // Beautiful header
        tableHTML += '<thead><tr>';
        Object.keys(data[0]).forEach(key => {
            if (key !== 'id' && key !== 'created_at' && key !== 'updated_at') {
                tableHTML += `<th>${this.formatColumnName(key)}</th>`;
            }
        });
        tableHTML += '</tr></thead>';
        
        // Beautiful body
        tableHTML += '<tbody>';
        data.forEach(row => {
            tableHTML += '<tr>';
            Object.entries(row).forEach(([key, value]) => {
                if (key !== 'id' && key !== 'created_at' && key !== 'updated_at') {
                    const formattedValue = this.formatCellValue(key, value);
                    tableHTML += `<td>${formattedValue}</td>`;
                }
            });
            tableHTML += '</tr>';
        });
        tableHTML += '</tbody></table>';
        
        tableContainer.innerHTML = tableHTML;
    }
    
    // Format column names beautifully
    formatColumnName(name) {
        return name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    
    // Format cell values beautifully
    formatCellValue(key, value) {
        if (value === null || value === undefined) return '<em class="text-muted">—</em>';
        
        // Currency formatting
        if (key.includes('amount') || key.includes('balance') || key.includes('total')) {
            const numValue = parseFloat(value);
            if (!isNaN(numValue)) {
                const formatted = this.formatCurrency(numValue);
                const cssClass = numValue >= 0 ? 'positive' : 'negative';
                return `<span class="currency ${cssClass}">${formatted}</span>`;
            }
        }
        
        // Date formatting
        if (key.includes('date') || key.includes('time')) {
            return new Date(value).toLocaleDateString();
        }
        
        // Percentage formatting
        if (key.includes('percent') || key.includes('rate')) {
            const numValue = parseFloat(value);
            if (!isNaN(numValue)) {
                return `<span class="badge bg-info">${numValue}%</span>`;
            }
        }
        
        return value;
    }
    
    // Beautiful currency formatting
    formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2
        }).format(amount);
    }
    
    // Update calculations with beautiful animations
    updateCalculations(data) {
        console.log('🧮 Updating calculations...');
        
        // Calculate totals
        const totals = this.calculateTotals(data);
        
        // Update UI with beautiful animations
        Object.entries(totals).forEach(([key, value]) => {
            const element = document.querySelector(`[data-calculation="${key}"]`);
            if (element) {
                this.animateValueChange(element, value);
            }
        });
        
        
// Calculate grand totals for financial data
function calculateGrandTotal() {
    let total = 0;
    const values = document.querySelectorAll('.currency-value');
    values.forEach(value => {
        const amount = parseFloat(value.textContent.replace(/[$,]/g, ''));
        if (!isNaN(amount)) {
            total += amount;
        }
    });
    
    const totalElement = document.querySelector('.grand-total');
    if (totalElement) {
        totalElement.textContent = formatCurrency(total);
    }
}

// Format currency values
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    }).format(amount);
}

    }
    
    // Create beautiful data visualization
    createVisualization(data) {
        const ctx = document.getElementById('main-chart');
        if (!ctx || !data.length) return;
        
        // Prepare data for Chart.js
        const chartData = this.prepareChartData(data);
        
        new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Passport | AppFolio Trends',
                        font: {
                            family: 'Inter',
                            size: 16,
                            weight: '600'
                        }
                    },
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                },
                elements: {
                    line: {
                        tension: 0.4
                    },
                    point: {
                        radius: 4,
                        hoverRadius: 6
                    }
                }
            }
        });
    }
    
    // Prepare chart data from database
    prepareChartData(data) {
        // This would be customized based on the specific page type
        return {
            labels: data.map((_, index) => `Period ${index + 1}`),
            datasets: [{
                label: 'Values',
                data: data.map(row => Object.values(row)[1]), // First numeric column
                borderColor: 'rgb(11, 83, 148)',
                backgroundColor: 'rgba(11, 83, 148, 0.1)',
                fill: true
            }]
        };
    }
    
    // Calculate totals and summaries
    calculateTotals(data) {
        const totals = {};
        
        if (!data.length) return totals;
        
        // Calculate sums for numeric columns
        Object.keys(data[0]).forEach(key => {
            if (key.includes('amount') || key.includes('balance') || key.includes('total')) {
                totals[key] = data.reduce((sum, row) => {
                    const value = parseFloat(row[key]) || 0;
                    return sum + value;
                }, 0);
            }
        });
        
        return totals;
    }
    
    // Animate value changes
    animateValueChange(element, newValue) {
        const currentValue = parseFloat(element.textContent.replace(/[^\d.-]/g, '')) || 0;
        const duration = 1000;
        const startTime = performance.now();
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            
            const interpolatedValue = currentValue + (newValue - currentValue) * easeOutQuart;
            
            if (element.classList.contains('currency')) {
                element.textContent = this.formatCurrency(interpolatedValue);
            } else {
                element.textContent = Math.round(interpolatedValue).toLocaleString();
            }
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }
    
    // Show beautiful error messages
    showErrorMessage(message) {
        const alertHTML = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        
        const container = document.querySelector('.content-wrapper');
        container.insertAdjacentHTML('afterbegin', alertHTML);
    }
}

// Initialize beautiful page functionality
document.addEventListener('DOMContentLoaded', function() {
    console.log('🎨 Initializing beautiful AIVIIZN page...');
    
    const db = new AIVIIZNDatabase();
    db.loadPageData();
    
    // Initialize all beautiful interactions
    initializeFilters();
    initializeDatePickers();
    initializeDataTables();
    initializeCalculations();
    initializeAnimations();
    
    console.log('✨ Beautiful AIVIIZN page ready!');
});

// Beautiful filter functionality
function initializeFilters() {
    const filters = document.querySelectorAll('.filter-control');
    filters.forEach(filter => {
        filter.addEventListener('change', function() {
            const loading = document.querySelector('.content-wrapper');
            loading.classList.add('loading');
            
            setTimeout(() => {
                updateDataDisplay();
                loading.classList.remove('loading');
            }, 500);
        });
    });
}

// Beautiful date picker initialization
function initializeDatePickers() {
    const datePickers = document.querySelectorAll('.date-picker');
    datePickers.forEach(picker => {
        picker.addEventListener('change', function() {
            refreshReportData();
        });
    });
}

// Beautiful data table functionality
function initializeDataTables() {
    const tables = document.querySelectorAll('.data-grid');
    tables.forEach(table => {
        addTableSorting(table);
        addTableFiltering(table);
        addTableAnimations(table);
    });
}

// Beautiful real-time calculations
function initializeCalculations() {
    const calculationFields = document.querySelectorAll('.calculation-field');
    calculationFields.forEach(field => {
        field.addEventListener('input', function() {
            recalculateAllTotals();
        });
    });
}

// Beautiful animations
function initializeAnimations() {
    // Intersection Observer for scroll animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animation = 'fadeInUp 0.6s ease forwards';
            }
        });
    });
    
    document.querySelectorAll('.data-grid, .aiviizn-form, .card').forEach(el => {
        observer.observe(el);
    });
}

// Export functions
function exportToPDF() {
    console.log('📄 Exporting to beautiful PDF...');
    // Implementation would go here
    alert('PDF export functionality would be implemented here');
}

function exportToExcel() {
    console.log('📊 Exporting to Excel...');
    // Implementation would go here
    alert('Excel export functionality would be implemented here');
}

function refreshData() {
    console.log('🔄 Refreshing data...');
    const db = new AIVIIZNDatabase();
    db.loadPageData();
    
    // Update timestamp
    document.getElementById('last-updated').textContent = new Date().toLocaleString();
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
`;
document.head.appendChild(style);

</script>
{% endblock %}
