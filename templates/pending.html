
{% extends 'base.html' %}

{% block title %}Vacancies - AppFolio Property Manager{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    :root {
        --primary-color: #2563eb;
        --secondary-color: #64748b;
        --success-color: #059669;
        --warning-color: #d97706;
        --danger-color: #dc2626;
        --light-gray: #f8fafc;
        --medium-gray: #e2e8f0;
        --dark-gray: #334155;
    }

    .content-wrapper {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        min-height: 100vh;
    }

    .page-title {
        color: var(--dark-gray);
        font-weight: 700;
        margin-bottom: 2rem;
        position: relative;
    }

    .page-title::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        border-radius: 2px;
    }

    .subnav-tabs {
        background: white;
        border-radius: 12px;
        padding: 0.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        display: flex;
        flex-wrap: wrap;
        list-style: none;
        gap: 0.5rem;
    }

    .subnav-tabs li a {
        display: block;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        color: var(--secondary-color);
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
        position: relative;
        overflow: hidden;
    }

    .subnav-tabs li a::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.5s;
    }

    .subnav-tabs li a:hover::before {
        left: 100%;
    }

    .subnav-tabs li a:hover {
        color: var(--primary-color);
        background-color: var(--light-gray);
        transform: translateY(-2px);
    }

    .subnav-tabs li.is-selected a {
        background: linear-gradient(135deg, var(--primary-color), #3b82f6);
        color: white;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    }

    .filter-box {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        border: 1px solid var(--medium-gray);
    }

    .filter-box__instructions {
        color: var(--dark-gray);
        font-weight: 600;
        margin-bottom: 1.5rem;
    }

    .ai-enhanced {
        position: relative;
        overflow: hidden;
    }

    .ai-enhanced::before {
        content: 'ðŸ¤–';
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        font-size: 14px;
        opacity: 0.7;
        z-index: 10;
    }

    .ai-enhanced:focus {
        border-color: #a855f7;
        box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        background: linear-gradient(135deg, #faf5ff, #f3e8ff);
    }

    .form__row {
        margin-bottom: 1.5rem;
    }

    .form__row__label {
        display: block;
        font-weight: 600;
        color: var(--dark-gray);
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-control, .form-select {
        border: 2px solid var(--medium-gray);
        border-radius: 8px;
        padding: 0.75rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: white;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        transform: translateY(-1px);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), #3b82f6);
        border: none;
        border-radius: 8px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:active {
        transform: translateY(0);
    }

    .vacancy-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--medium-gray);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .vacancy-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--success-color));
    }

    .vacancy-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .unit-property-card__image-container {
        width: 120px;
        height: 120px;
        border-radius: 12px;
        overflow: hidden;
        margin: 0 auto 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .unit-property-card__image_div {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        transition: transform 0.3s ease;
    }

    .vacancy-card:hover .unit-property-card__image_div {
        transform: scale(1.05);
    }

    .unit-property-card__main-info a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 700;
        font-size: 1.1rem;
        transition: color 0.3s ease;
    }

    .unit-property-card__main-info a:hover {
        color: var(--success-color);
    }

    .unit-property-card__table {
        width: 100%;
        margin-top: 1rem;
    }

    .unit-property-card__table td {
        padding: 0.5rem 1rem 0.5rem 0;
        vertical-align: top;
    }

    .unit-property-card__tiny-header {
        font-size: 0.8rem;
        color: var(--secondary-color);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .action-table__vacancy-type {
        background: linear-gradient(135deg, var(--warning-color), #f59e0b);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 1rem;
    }

    .action-table__actions {
        width: 100%;
    }

    .action-table__actions td {
        padding: 0.75rem;
        border-bottom: 1px solid var(--medium-gray);
        font-size: 0.9rem;
    }

    .action-table__actions td:first-child {
        font-weight: 600;
        color: var(--dark-gray);
    }

    .posting-status {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .status-not-posted {
        background-color: #fee2e2;
        color: #dc2626;
    }

    .status-posted {
        background-color: #d1fae5;
        color: #059669;
    }

    .sort-options {
        background: white;
        padding: 1rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 1rem;
    }

    .options-dropdown__toggle {
        background: var(--secondary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .options-dropdown__toggle:hover {
        background: var(--dark-gray);
        transform: translateY(-1px);
    }

    .spinner {
        width: 40px;
        height: 40px;
        margin: 2rem auto;
        border: 4px solid var(--medium-gray);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .select2-container {
        border-radius: 8px;
    }

    .select2-container .select2-choice {
        height: 45px;
        line-height: 45px;
        border: 2px solid var(--medium-gray);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .select2-container.select2-container-active .select2-choice {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    @media (max-width: 768px) {
        .subnav-tabs {
            flex-direction: column;
        }
        
        .filter-box {
            padding: 1rem;
        }
        
        .vacancy-card {
            padding: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div id="content" class="content-wrapper position-fixed bottom-0 overflow-y-auto js-main-page vacancies index">
    <main class="main-container mx-auto px-3 w-100">
        <section class="js-page-content-body page__content-body page-content-body px-1 py-3">
            
            <div id="site-subtabs" class="full-screen-hide">
                <div class="js-responsive-table-container responsive-table u-medium-down-hidden">
                    <div class="js-responsive-table-inner responsive-table__inner">
                        <ul class="is-displayed-in-medium-down subnav-tabs" data-container-classes="u-medium-down-hidden" data-level="0">
                            <li class="is-selected"><a href="{{ url_for('vacancies.index') }}">Vacancies</a></li>
                            <li class=""><a href="{{ url_for('guest_cards.index') }}">Guest Cards</a></li>
                            <li class=""><a href="{{ url_for('rental_applications.index') }}">Rental Applications</a></li>
                            <li class=""><a href="{{ url_for('lease_documents.index') }}">Leases</a></li>
                            <li class=""><a href="{{ url_for('lease_renewals.index') }}">Renewals</a></li>
                            <li class=""><a href="{{ url_for('reports.box_score') }}">Metrics</a></li>
                            <li class=""><a href="{{ url_for('signals.index') }}">Signals</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div id="flash_messages"></div>

            <h1 class="page-title js-security-deposit-alternative-banner fade-in">Vacancies</h1>

            <section class="js-filterable-collection fade-in">
                <div class="js-filter-box filter-box">
                    <div class="js-filter-search-box">
                        <p class="filter-box__instructions">Filter your vacancies with the options below:</p>
                        <div class="js-filter-form">
                            <form class="form form--full-width" id="new_filters" data-type="json" autocomplete="off" novalidate="novalidate" action="{{ url_for('vacancies.index') }}" accept-charset="UTF-8" data-remote="true" method="get">

                                <div class="form__row">
                                    <label class="form__row__label" for="filters_properties_ids">Properties</label>
                                    <div class="form__row__body">
                                        <div class="form__row__field-wrapper">
                                            <input 
                                                type="text" 
                                                class="form-control ai-enhanced" 
                                                name="filters[properties_ids]" 
                                                id="filters_properties_ids" 
                                                placeholder="Search by property, group, owner, or portfolio"
                                                data-bs-toggle="tooltip"
                                                data-bs-placement="top"
                                                title="AI-enhanced property search"
                                            >
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form__row">
                                            <label class="form__row__label" for="filters_bedrooms">Bedrooms</label>
                                            <div class="form__row__body">
                                                <div class="form__row__field-wrapper">
                                                    <select class="form-select ai-enhanced" name="filters[bedrooms]" id="filters_bedrooms">
                                                        <option value="">Number of bedrooms</option>
                                                        <option value="0+">0+</option>
                                                        <option value="1+">1+</option>
                                                        <option value="2+">2+</option>
                                                        <option value="3+">3+</option>
                                                        <option value="4+">4+</option>
                                                        <option value="5+">5+</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form__row">
                                            <label class="form__row__label" for="filters_rent">Rent Range</label>
                                            <div class="form__row__body">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="input-group">
                                                            <span class="input-group-text">$</span>
                                                            <input type="text" class="form-control ai-enhanced" name="filters[min_rent]" id="filters_min_rent" placeholder="Minimum">
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="input-group">
                                                            <span class="input-group-text">$</span>
                                                            <input type="text" class="form-control ai-enhanced" name="filters[max_rent]" id="filters_max_rent" placeholder="Maximum">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form__row">
                                            <label class="form__row__label" for="filters_available_date">Available Date Range</label>
                                            <div class="form__row__body">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <input type="date" class="form-control ai-enhanced" name="filters[available_from]" id="filters_available_from" placeholder="Start date">
                                                    </div>
                                                    <div class="col-6">
                                                        <input type="date" class="form-control ai-enhanced" name="filters[available_to]" id="filters_available_to" placeholder="End date">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form__row">
                                            <label class="form__row__label" for="filters_cats">Cats Allowed</label>
                                            <div class="form__row__body">
                                                <select class="form-select ai-enhanced" name="filters[cats]" id="filters_cats">
                                                    <option value="">Any</option>
                                                    <option value="allowed">Yes</option>
                                                    <option value="not_allowed">No</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form__row">
                                            <label class="form__row__label" for="filters_dogs">Dogs Allowed</label>
                                            <div class="form__row__body">
                                                <select class="form-select ai-enhanced" name="filters[dogs]" id="filters_dogs">
                                                    <option value="">Any</option>
                                                    <option value="allowed">Large</option>
                                                    <option value="small_only_allowed">Small</option>
                                                    <option value="not_allowed">None</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" name="filters[sort_by]" id="filters_sort_by" value="vacantOn">

                                <div class="form__row">
                                    <div class="form__row__body">
                                        <div class="btn-toolbar">
                                            <button type="submit" class="btn btn-primary js-filter-submit" id="search_button">
                                                <i class="fas fa-search me-2"></i>Search Vacancies
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="text-center js-filter-search-box-loading" style="display: none;">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <div class="js-filter-waiting-message text-center d-none">
                    <div class="spinner"></div>
                </div>

                <div class="row m-0 mb-2">
                    <div class="col-12 col-sm-6 p-0">
                        <div class="js-vacancy-contact-info"></div>
                    </div>
                    <div class="sort-options col-12 col-sm-6 p-0 text-end">
                        <label for="sort_by" class="me-2">Sort By:</label>
                        <select name="sort_by" id="sort_by" class="form-select d-inline-block w-auto js-sort-by-field">
                            <option value="vacantOn" selected>Days Vacant</option>
                            <option value="rentlinxPostingVisible">Internet Posting Status</option>
                            <option value="propertyAndUnitName">Name</option>
                            <option value="marketRent">Market Rent</option>
                            <option value="advertisedRent">Advertised Rent</option>
                            <option value="websitePostingVisible">Website Posting Status</option>
                            <option value="bedrooms">Bedrooms</option>
                            <option value="availableOn">Available Date</option>
                        </select>
                    </div>
                </div>

                <p class="js-filter-no-results text-center d-none">No vacancies found matching your criteria.</p>

                <div class="js-filter-results js-listable-cards-container">
                    <div class="vacancy-card fade-in" data-property-id="226" data-property-name="Gene Field Apts / DW Gene Field LLC / Ryan Deutsch">
                        <div class="js-listable-alert-area"></div>
                        <div class="unit-property-card">
                            <div class="row">
                                <div class="col-lg-3 text-center d-none d-lg-block">
                                    <div class="unit-property-card__image-container">
                                        <div class="unit-property-card__image_div" style="background-image: url('//property.cdn.appfolio.com/assets/property/property_types/Multi-Family-0dbb23fc5b8408ee8bdf1c474535d20b5702b1c57135006fd23d790edc618bbf.svg')"></div>
                                    </div>
                                    <div class="unit-property-card__image-caption text-muted">0 Photos</div>
                                </div>

                                <div class="col-lg-5 col-md-7 col-12">
                                    <div class="unit-property-card__main-info">
                                        <div class="mb-2">
                                            <a href="{{ url_for('properties.unit_detail', property_id=226, unit_id=3627) }}">Gene Field Apts / DW Gene Field LLC / Ryan Deutsch - 10-02</a>
                                        </div>
                                        <div class="text-muted mb-3">3515 Gene Field Rd. - 10-02, St. Joseph, MO 64506</div>
                                    </div>

                                    <table class="unit-property-card__table">
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span class="unit-property-card__tiny-header">BD/BA</span><br>
                                                    <span class="fw-bold">1/1</span>
                                                </td>
                                                <td>
                                                    <span class="unit-property-card__tiny-header">Sq. Ft.</span><br>
                                                    <span class="fw-bold">731</span>
                                                </td>
                                                <td>
                                                    <span class="unit-property-card__tiny-header">Rent</span><br>
                                                    <span class="fw-bold text-success">$546</span>
                                                </td>
                                                <td>
                                                    <span class="unit-property-card__tiny-header">Available</span><br>
                                                    <span class="fw-bold text-primary">Now</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="col-lg-4 col-md-5 col-12">
                                    <div class="action-table">
                                        <p class="action-table__vacancy-type">Vacant For: 1067 days</p>
                                        
                                        <div class="dropdown mb-3">
                                            <button class="options-dropdown__toggle dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                Actions <i class="fas fa-ellipsis-v ms-1"></i>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="{{ url_for('vacancies.marketing_flyer', unit_id=3627) }}">Download Marketing Flyer</a></li>
                                                <li><a class="dropdown-item" href="{{ url_for('properties.post_manually', property_id=226, unit_id=3627) }}">Post Vacancy Manually</a></li>
                                                <li><a class="dropdown-item" href="{{ url_for('vacancies.exclude_unit', unit_id=3627) }}">Remove from Vacancies List</a></li>
                                            </ul>
                                        </div>

                                        <table class="action-table__actions">
                                            <tbody>
                                                <tr>
                                                    <td><strong>Website</strong></td>
                                                    <td><span class="posting-status status-not-posted">Not Posted</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary w-100" onclick="togglePosting('website', 3627)">Post</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Internet</strong></td>
                                                    <td><span class="posting-status status-not-posted">Not Posted</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary w-100" onclick="togglePosting('internet', 3627)">Post</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Premium</strong></td>
                                                    <td><span class="posting-status status-not-posted">Off</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-success w-100" onclick="togglePremium(3627)">Activate</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
$(document).ready(function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // Initialize Select2
    $('#filters_properties_ids').select2({
        placeholder: 'Search by property, group, owner, or portfolio',
        allowClear: true,
        ajax: {
            url: '{{ url_for("search.properties") }}',
            dataType: 'json',
            delay: 250,
            processResults: function (data) {
                return {
                    results: data.map(item => ({
                        id: item.id,
                        text: item.name
                    }))
                };
            }
        }
    });

    $('#filters_bedrooms').select2({
        placeholder: 'Number of bedrooms',
        allowClear: true
    });

    // Form submission with loading state
    $('#new_filters').on('submit', function(e) {
        e.preventDefault();
        const submitBtn = $('#search_button');
        const originalText = submitBtn.html();
        
        submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Searching...').prop('disabled', true);
        $('.js-filter-search-box-loading').show();
        
        // Simulate API call
        setTimeout(() => {
            submitBtn.html(originalText).prop('disabled', false);
            $('.js-filter-search-box-loading').hide();
            filterVacancies();
        }, 1500);
    });

    // Sort functionality
    $('#sort_by').on('change', function() {
        $('#filters_sort_by').val($(this).val());
        $('#new_filters').submit();
    });

    // Auto-save filters
    $('.ai-enhanced').on('change', debounce(function() {
        if ($(this).val()) {
            $(this).addClass('border-success');
            setTimeout(() => $(this).removeClass('border-success'), 2000);
        }
    }, 500));
});

// Toggle posting status
function togglePosting(type, unitId) {
    const button = event.target;
    const statusCell = button.closest('tr').querySelector('.posting-status');
    const originalText = button.textContent;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    // Simulate API call
    fetch(`{{ url_for('properties.toggle_posting') }}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token() }}'
        },
        body: JSON.stringify({
            unit_id: unitId,
            posting_type: type
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (statusCell.textContent === 'Not Posted') {
                statusCell.innerHTML = '<span class="posting-status status-posted">Posted</span>';
                button.textContent = 'Unpost';
                button.className = 'btn btn-sm btn-outline-danger w-100';
            } else {
                statusCell.innerHTML = '<span class="posting-status status-not-posted">Not Posted</span>';
                button.textContent = 'Post';
                button.className = 'btn btn-sm btn-primary w-100';
            }
            
            showToast('Posting status updated successfully', 'success');
        } else {
            showToast('Error updating posting status', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error updating posting status', 'error');
        button.textContent = originalText;
    })
    .finally(() => {
        button.disabled = false;
    });
}

// Toggle premium status
function togglePremium(unitId) {
    const button = event.target;
    const statusCell = button.closest('tr').querySelector('.posting-status');
    const originalText = button.textContent;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        if (statusCell.textContent === 'Off') {
            statusCell.innerHTML = '<span class="posting-status status-posted">On</span>';
            button.textContent = 'Turn Off';
            button.className = 'btn btn-sm btn-outline-danger w-100';
            showToast('Premium posting activated', 'success');
        } else {
            statusCell.innerHTML = '<span class="posting-status status-not-posted">Off</span>';
            button.textContent = 'Activate';
            button.className = 'btn btn-sm btn-success w-100';
            showToast('Premium posting deactivated', 'success');
        }
        button.disabled = false;
    }, 1000);
}

// Filter vacancies
function filterVacancies() {
    const formData = new FormData(document.getElementById('new_filters'));
    const params = new URLSearchParams(formData);
    
    // Simulate filtering (in real app, this would be an API call)
    const hasFilters = Array.from(formData.values()).some(value => value && value.trim());
    
    if (hasFilters) {
        showToast('Filters applied successfully', 'info');
    }
}

// Utility functions
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function showToast(message, type = 'info') {
    const toast = `
        <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed top-0 end-0 p-3';
        document.body.appendChild(container);
    }
    
    container.insertAdjacentHTML('beforeend', toast);
    const toastElement = container.lastElementChild;
    const bsToast = new bootstrap.Toast(toastElement);
    bsToast.show();
    
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
}

// Real-time search for properties
$('#filters_properties_ids').on('input', debounce(function() {
    const query = $(this).val();
    if (query.length >= 2) {
        // Simulate AI-enhanced search
        $(this).addClass('border-primary');
        // In real implementation, this would call Supabase/API
    } else {
        $(this).removeClass('border-primary');
    }
}, 300));

// Initialize animations
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.animationDelay = Math.random() * 0.5 + 's';
            entry.target.classList.add('fade-in');
        }
    });
});

document.querySelectorAll('.vacancy-card').forEach(card => {
    observer.observe(card);
});
</script>
{% endblock %}
