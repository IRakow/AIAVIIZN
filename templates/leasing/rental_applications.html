{% extends "base.html" %}

{% block title %}Rental Applications - AIVIIZN Property Management{% endblock %}

{% block content %}
<div class="content-header">
    <h2>Rental Applications</h2>
</div>

<div class="content-body">
    <!-- Sub-navigation tabs -->
    <ul class="nav nav-tabs mb-3" style="background: white; padding: 10px 10px 0; border-radius: 4px 4px 0 0;">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('vacancies') }}">Vacancies</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('guest_cards') }}">Guest Cards</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('rental_applications') }}">Rental Applications</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('leases') }}">Leases</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('renewals') }}">Renewals</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('leasing_metrics') }}">Metrics</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('signals') }}">Signals</a>
        </li>
    </ul>

    <div class="applications-container">
        <!-- Page Header with Actions -->
        <div class="page-header">
            <div class="header-left">
                <h3 class="page-title">Rental Applications</h3>
                <p class="page-subtitle">Review and process rental applications</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline-primary" onclick="importApplications()">
                    <i class="fas fa-upload"></i> Import
                </button>
                <button class="btn btn-outline-primary" onclick="exportApplications()">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-primary" onclick="newApplication()">
                    <i class="fas fa-plus"></i> New Application
                </button>
            </div>
        </div>

        <!-- Search and Filter Panel -->
        <div class="search-filter-panel">
            <!-- Advanced Search Box -->
            <div class="search-box-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search applications by tenant name, email, phone, or property..." 
                           onkeyup="performSearch()" onfocus="expandSearch()" onblur="collapseSearch()">
                    <button class="btn-search-clear" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="search-suggestions" id="searchSuggestions" style="display: none;">
                    <div class="suggestion-item">Search by tenant name</div>
                    <div class="suggestion-item">Search by property name</div>
                    <div class="suggestion-item">Search by application status</div>
                    <div class="suggestion-item">Search by credit score range</div>
                </div>
            </div>

            <!-- Quick Filters -->
            <div class="quick-filters">
                <button class="filter-chip active" onclick="setQuickFilter('all')">
                    All Applications <span class="chip-count">47</span>
                </button>
                <button class="filter-chip" onclick="setQuickFilter('pending')">
                    Pending Review <span class="chip-count">12</span>
                </button>
                <button class="filter-chip" onclick="setQuickFilter('processing')">
                    Processing <span class="chip-count">8</span>
                </button>
                <button class="filter-chip" onclick="setQuickFilter('approved')">
                    Approved <span class="chip-count">15</span>
                </button>
                <button class="filter-chip urgent" onclick="setQuickFilter('urgent')">
                    Needs Attention <span class="chip-count">6</span>
                </button>
            </div>

            <!-- Advanced Filters (Collapsible) -->
            <div class="advanced-filters" id="advancedFilters">
                <div class="filters-toggle" onclick="toggleAdvancedFilters()">
                    <span><i class="fas fa-filter"></i> Advanced Filters</span>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                
                <div class="filters-content" style="display: none;">
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Application Date:</label>
                            <div class="date-range">
                                <input type="date" id="dateFrom" onchange="applyAdvancedFilters()">
                                <span>to</span>
                                <input type="date" id="dateTo" onchange="applyAdvancedFilters()">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Property:</label>
                            <select id="propertyFilter" onchange="applyAdvancedFilters()" multiple>
                                <option value="sunset-apts">Sunset Apartments</option>
                                <option value="oak-grove">Oak Grove Complex</option>
                                <option value="city-view">City View Towers</option>
                                <option value="pine-ridge">Pine Ridge Manor</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Credit Score Range:</label>
                            <div class="credit-range">
                                <input type="number" id="creditMin" placeholder="Min" min="300" max="850" onchange="applyAdvancedFilters()">
                                <span>to</span>
                                <input type="number" id="creditMax" placeholder="Max" min="300" max="850" onchange="applyAdvancedFilters()">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Monthly Income:</label>
                            <div class="income-range">
                                <input type="number" id="incomeMin" placeholder="Min" onchange="applyAdvancedFilters()">
                                <span>to</span>
                                <input type="number" id="incomeMax" placeholder="Max" onchange="applyAdvancedFilters()">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Application Source:</label>
                            <select id="sourceFilter" onchange="applyAdvancedFilters()">
                                <option value="all">All Sources</option>
                                <option value="website">Company Website</option>
                                <option value="zillow">Zillow</option>
                                <option value="apartments">Apartments.com</option>
                                <option value="referral">Referral</option>
                                <option value="walk-in">Walk-in</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Documents Status:</label>
                            <select id="documentsFilter" onchange="applyAdvancedFilters()">
                                <option value="all">All</option>
                                <option value="complete">Complete</option>
                                <option value="incomplete">Incomplete</option>
                                <option value="pending">Pending Upload</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn btn-primary" onclick="applyAdvancedFilters()">Apply Filters</button>
                        <button class="btn btn-outline-secondary" onclick="clearAdvancedFilters()">Clear All</button>
                        <button class="btn btn-outline-secondary" onclick="saveFilterPreset()">Save Preset</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applications Summary Stats -->
        <div class="applications-summary">
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-number">47</div>
                    <div class="stat-label">Total Applications</div>
                    <div class="stat-change positive">+12 this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">68%</div>
                    <div class="stat-label">Approval Rate</div>
                    <div class="stat-change neutral">Same as last month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3.2</div>
                    <div class="stat-label">Avg Days to Process</div>
                    <div class="stat-change positive">-0.5 days</div>
                </div>
                <div class="stat-card urgent">
                    <div class="stat-number">6</div>
                    <div class="stat-label">Need Attention</div>
                    <div class="stat-change">Overdue review</div>
                </div>
            </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" id="bulkActionsBar" style="display: none;">
            <div class="bulk-info">
                <span id="selectedCount">0</span> applications selected
            </div>
            <div class="bulk-buttons">
                <button class="btn-bulk" onclick="bulkApprove()">
                    <i class="fas fa-check"></i> Approve Selected
                </button>
                <button class="btn-bulk" onclick="bulkDeny()">
                    <i class="fas fa-times"></i> Deny Selected
                </button>
                <button class="btn-bulk" onclick="bulkRequestDocuments()">
                    <i class="fas fa-file-upload"></i> Request Documents
                </button>
                <button class="btn-bulk" onclick="bulkSendEmails()">
                    <i class="fas fa-envelope"></i> Send Emails
                </button>
                <button class="btn-bulk" onclick="bulkExport()">
                    <i class="fas fa-download"></i> Export Selected
                </button>
            </div>
            <button class="btn-clear-selection" onclick="clearSelection()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Applications Table -->
        <div class="data-table">
            <div class="table-controls">
                <div class="view-options">
                    <label>View:</label>
                    <select id="viewMode" onchange="changeViewMode()">
                        <option value="detailed" selected>Detailed View</option>
                        <option value="compact">Compact View</option>
                        <option value="card">Card View</option>
                    </select>
                    
                    <label style="margin-left: 20px;">Sort:</label>
                    <select id="sortOptions" onchange="applySorting()">
                        <option value="date-desc" selected>Application Date (Newest)</option>
                        <option value="date-asc">Application Date (Oldest)</option>
                        <option value="name">Applicant Name</option>
                        <option value="credit-desc">Credit Score (Highest)</option>
                        <option value="credit-asc">Credit Score (Lowest)</option>
                        <option value="income-desc">Income (Highest)</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                
                <div class="table-actions">
                    <button class="btn-toggle" onclick="toggleSelectAll()">
                        <i class="fas fa-check-square"></i> Select All
                    </button>
                    <button class="btn-toggle" onclick="refreshApplications()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <table id="applicationsTable">
                <thead>
                    <tr>
                        <th class="checkbox-col">
                            <input type="checkbox" id="selectAllCheckbox" onchange="handleSelectAll()">
                        </th>
                        <th class="sortable" data-sort="applicant">
                            Applicant <i class="fas fa-sort"></i>
                        </th>
                        <th class="sortable" data-sort="property">
                            Property / Unit <i class="fas fa-sort"></i>
                        </th>
                        <th class="sortable" data-sort="date">
                            Application Date <i class="fas fa-sort-down"></i>
                        </th>
                        <th class="sortable" data-sort="credit">
                            Credit Score <i class="fas fa-sort"></i>
                        </th>
                        <th class="sortable" data-sort="income">
                            Monthly Income <i class="fas fa-sort"></i>
                        </th>
                        <th class="sortable" data-sort="documents">
                            Documents <i class="fas fa-sort"></i>
                        </th>
                        <th class="sortable" data-sort="status">
                            Status <i class="fas fa-sort"></i>
                        </th>
                        <th>Score</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="applicationsTableBody">
                    <!-- Sample Application Rows -->
                    <tr class="application-row" data-id="1" data-status="pending">
                        <td><input type="checkbox" class="row-checkbox" value="1" onchange="updateSelection()"></td>
                        <td>
                            <div class="applicant-info">
                                <div class="applicant-primary">
                                    <strong>Sarah M. Johnson</strong>
                                    <span class="applicant-type">Primary</span>
                                </div>
                                <div class="applicant-contact">
                                    <span><i class="fas fa-envelope"></i> sarah.johnson@email.com</span>
                                    <span><i class="fas fa-phone"></i> (555) 123-4567</span>
                                </div>
                                <div class="co-applicants">
                                    <span class="co-applicant">+ Michael Johnson (Spouse)</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <strong>Sunset Apartments</strong>
                                <div class="unit-info">
                                    <span class="unit-number">Unit A-205</span>
                                    <span class="rent-amount">$1,250/mo</span>
                                </div>
                                <div class="property-address">1234 Sunset Blvd, Phoenix AZ</div>
                            </div>
                        </td>
                        <td>
                            <div class="date-info">
                                <strong>Aug 15, 2025</strong>
                                <div class="time-info">2:30 PM</div>
                                <div class="days-ago">3 days ago</div>
                            </div>
                        </td>
                        <td>
                            <div class="credit-score excellent">
                                <span class="score-number">742</span>
                                <span class="score-label">Excellent</span>
                                <div class="score-details">
                                    <small>Co-applicant: 728</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="income-info">
                                <span class="income-amount">$5,200</span>
                                <div class="income-ratio good">
                                    <small>DTI: 24% <i class="fas fa-check-circle"></i></small>
                                </div>
                                <div class="income-source">Software Engineer</div>
                            </div>
                        </td>
                        <td>
                            <div class="documents-status">
                                <div class="doc-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%"></div>
                                    </div>
                                    <span class="progress-text">8/9 Complete</span>
                                </div>
                                <div class="missing-docs">
                                    <small class="warning">Missing: Bank Statement</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-container">
                                <span class="status-badge status-pending">Pending Review</span>
                                <div class="status-timeline">
                                    <small>Updated 1 hour ago</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="application-score excellent">
                                <span class="score-value">92</span>
                                <div class="score-breakdown">
                                    <div class="score-item">Credit: 95</div>
                                    <div class="score-item">Income: 90</div>
                                    <div class="score-item">History: 88</div>
                                </div>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <button class="btn-action btn-review" onclick="reviewApplication(1)" title="Review Application">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action btn-approve" onclick="quickApprove(1)" title="Quick Approve">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn-action btn-deny" onclick="quickDeny(1)" title="Quick Deny">
                                    <i class="fas fa-times"></i>
                                </button>
                                <div class="action-dropdown">
                                    <button class="btn-action btn-more" onclick="toggleActionMenu(1)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu" id="actionMenu1">
                                        <a href="#" onclick="requestDocuments(1)">Request Documents</a>
                                        <a href="#" onclick="scheduleShowing(1)">Schedule Showing</a>
                                        <a href="#" onclick="sendEmail(1)">Send Email</a>
                                        <a href="#" onclick="addNote(1)">Add Note</a>
                                        <a href="#" onclick="duplicateApplication(1)">Duplicate</a>
                                        <a href="#" onclick="deleteApplication(1)">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <tr class="application-row" data-id="2" data-status="processing">
                        <td><input type="checkbox" class="row-checkbox" value="2" onchange="updateSelection()"></td>
                        <td>
                            <div class="applicant-info">
                                <div class="applicant-primary">
                                    <strong>David Chen</strong>
                                    <span class="applicant-type">Primary</span>
                                </div>
                                <div class="applicant-contact">
                                    <span><i class="fas fa-envelope"></i> david.chen@techcorp.com</span>
                                    <span><i class="fas fa-phone"></i> (555) 987-6543</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <strong>Oak Grove Complex</strong>
                                <div class="unit-info">
                                    <span class="unit-number">Unit B-12</span>
                                    <span class="rent-amount">$1,450/mo</span>
                                </div>
                                <div class="property-address">567 Oak St, Phoenix AZ</div>
                            </div>
                        </td>
                        <td>
                            <div class="date-info">
                                <strong>Aug 12, 2025</strong>
                                <div class="time-info">11:15 AM</div>
                                <div class="days-ago">6 days ago</div>
                            </div>
                        </td>
                        <td>
                            <div class="credit-score good">
                                <span class="score-number">678</span>
                                <span class="score-label">Good</span>
                            </div>
                        </td>
                        <td>
                            <div class="income-info">
                                <span class="income-amount">$4,800</span>
                                <div class="income-ratio good">
                                    <small>DTI: 30% <i class="fas fa-check-circle"></i></small>
                                </div>
                                <div class="income-source">Product Manager</div>
                            </div>
                        </td>
                        <td>
                            <div class="documents-status">
                                <div class="doc-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 100%"></div>
                                    </div>
                                    <span class="progress-text">Complete</span>
                                </div>
                                <div class="complete-docs">
                                    <small class="success">All documents received</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-container">
                                <span class="status-badge status-processing">Processing</span>
                                <div class="status-timeline">
                                    <small>Credit check in progress</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="application-score good">
                                <span class="score-value">78</span>
                                <div class="score-breakdown">
                                    <div class="score-item">Credit: 75</div>
                                    <div class="score-item">Income: 82</div>
                                    <div class="score-item">History: 77</div>
                                </div>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <button class="btn-action btn-review" onclick="reviewApplication(2)">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action btn-processing" onclick="viewProcessing(2)" title="View Processing Status">
                                    <i class="fas fa-clock"></i>
                                </button>
                                <div class="action-dropdown">
                                    <button class="btn-action btn-more" onclick="toggleActionMenu(2)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu" id="actionMenu2">
                                        <a href="#" onclick="expediteProcessing(2)">Expedite Processing</a>
                                        <a href="#" onclick="addNote(2)">Add Note</a>
                                        <a href="#" onclick="sendEmail(2)">Send Update Email</a>
                                        <a href="#" onclick="deleteApplication(2)">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <tr class="application-row" data-id="3" data-status="approved">
                        <td><input type="checkbox" class="row-checkbox" value="3" onchange="updateSelection()"></td>
                        <td>
                            <div class="applicant-info">
                                <div class="applicant-primary">
                                    <strong>Emily Rodriguez</strong>
                                    <span class="applicant-type">Primary</span>
                                </div>
                                <div class="applicant-contact">
                                    <span><i class="fas fa-envelope"></i> emily.rodriguez@email.com</span>
                                    <span><i class="fas fa-phone"></i> (555) 456-7890</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <strong>City View Towers</strong>
                                <div class="unit-info">
                                    <span class="unit-number">Unit 15C</span>
                                    <span class="rent-amount">$1,800/mo</span>
                                </div>
                                <div class="property-address">890 Downtown Ave, Phoenix AZ</div>
                            </div>
                        </td>
                        <td>
                            <div class="date-info">
                                <strong>Aug 10, 2025</strong>
                                <div class="time-info">3:45 PM</div>
                                <div class="days-ago">8 days ago</div>
                            </div>
                        </td>
                        <td>
                            <div class="credit-score excellent">
                                <span class="score-number">756</span>
                                <span class="score-label">Excellent</span>
                            </div>
                        </td>
                        <td>
                            <div class="income-info">
                                <span class="income-amount">$6,500</span>
                                <div class="income-ratio excellent">
                                    <small>DTI: 28% <i class="fas fa-check-circle"></i></small>
                                </div>
                                <div class="income-source">Marketing Director</div>
                            </div>
                        </td>
                        <td>
                            <div class="documents-status">
                                <div class="doc-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 100%"></div>
                                    </div>
                                    <span class="progress-text">Complete</span>
                                </div>
                                <div class="complete-docs">
                                    <small class="success">Verified</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-container">
                                <span class="status-badge status-approved">Approved</span>
                                <div class="status-timeline">
                                    <small>Approved 2 days ago</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="application-score excellent">
                                <span class="score-value">94</span>
                                <div class="score-breakdown">
                                    <div class="score-item">Credit: 96</div>
                                    <div class="score-item">Income: 93</div>
                                    <div class="score-item">History: 92</div>
                                </div>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <button class="btn-action btn-review" onclick="reviewApplication(3)">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action btn-lease" onclick="createLease(3)" title="Create Lease">
                                    <i class="fas fa-file-contract"></i>
                                </button>
                                <div class="action-dropdown">
                                    <button class="btn-action btn-more" onclick="toggleActionMenu(3)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu" id="actionMenu3">
                                        <a href="#" onclick="createLease(3)">Generate Lease</a>
                                        <a href="#" onclick="sendApprovalLetter(3)">Send Approval Letter</a>
                                        <a href="#" onclick="scheduleMovein(3)">Schedule Move-in</a>
                                        <a href="#" onclick="addNote(3)">Add Note</a>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <tr class="application-row urgent" data-id="4" data-status="denied">
                        <td><input type="checkbox" class="row-checkbox" value="4" onchange="updateSelection()"></td>
                        <td>
                            <div class="applicant-info">
                                <div class="applicant-primary">
                                    <strong>James Wilson</strong>
                                    <span class="applicant-type">Primary</span>
                                </div>
                                <div class="applicant-contact">
                                    <span><i class="fas fa-envelope"></i> j.wilson@email.com</span>
                                    <span><i class="fas fa-phone"></i> (555) 321-0987</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <strong>Pine Ridge Manor</strong>
                                <div class="unit-info">
                                    <span class="unit-number">Unit 7A</span>
                                    <span class="rent-amount">$1,350/mo</span>
                                </div>
                                <div class="property-address">456 Pine St, Phoenix AZ</div>
                            </div>
                        </td>
                        <td>
                            <div class="date-info">
                                <strong>Aug 8, 2025</strong>
                                <div class="time-info">9:20 AM</div>
                                <div class="days-ago">10 days ago</div>
                            </div>
                        </td>
                        <td>
                            <div class="credit-score poor">
                                <span class="score-number">542</span>
                                <span class="score-label">Poor</span>
                            </div>
                        </td>
                        <td>
                            <div class="income-info">
                                <span class="income-amount">$3,200</span>
                                <div class="income-ratio poor">
                                    <small>DTI: 42% <i class="fas fa-exclamation-triangle"></i></small>
                                </div>
                                <div class="income-source">Retail Manager</div>
                            </div>
                        </td>
                        <td>
                            <div class="documents-status">
                                <div class="doc-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%"></div>
                                    </div>
                                    <span class="progress-text">6/9 Complete</span>
                                </div>
                                <div class="missing-docs">
                                    <small class="warning">Missing: Pay stubs, References</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status-container">
                                <span class="status-badge status-denied">Denied</span>
                                <div class="status-timeline">
                                    <small>Denied 5 days ago</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="application-score poor">
                                <span class="score-value">45</span>
                                <div class="score-breakdown">
                                    <div class="score-item">Credit: 35</div>
                                    <div class="score-item">Income: 48</div>
                                    <div class="score-item">History: 52</div>
                                </div>
                            </div>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <button class="btn-action btn-review" onclick="reviewApplication(4)">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action btn-denied" onclick="viewDenialReason(4)" title="View Denial Reason">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <div class="action-dropdown">
                                    <button class="btn-action btn-more" onclick="toggleActionMenu(4)">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu" id="actionMenu4">
                                        <a href="#" onclick="sendDenialLetter(4)">Send Denial Letter</a>
                                        <a href="#" onclick="reconsiderApplication(4)">Reconsider Application</a>
                                        <a href="#" onclick="addNote(4)">Add Note</a>
                                        <a href="#" onclick="archiveApplication(4)">Archive</a>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                Showing 1-4 of 47 applications
            </div>
            <div class="pagination-controls">
                <button class="btn-page" disabled><i class="fas fa-chevron-left"></i></button>
                <button class="btn-page active">1</button>
                <button class="btn-page">2</button>
                <button class="btn-page">3</button>
                <button class="btn-page">...</button>
                <button class="btn-page">12</button>
                <button class="btn-page"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</div>

<style>
    .applications-container {
        background-color: white;
        border-radius: 4px;
        padding: 20px;
    }

    /* Page Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #dee2e6;
    }

    .header-left .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #212529;
        margin: 0 0 5px 0;
        font-family: 'Inter', sans-serif;
    }

    .header-left .page-subtitle {
        color: #6c757d;
        font-size: 14px;
        margin: 0;
    }

    .header-actions {
        display: flex;
        gap: 10px;
    }

    .btn {
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
    }

    .btn-primary {
        background-color: #0B5394;
        color: white;
    }

    .btn-primary:hover {
        background-color: #073763;
    }

    .btn-outline-primary {
        background-color: transparent;
        color: #0B5394;
        border: 1px solid #0B5394;
    }

    .btn-outline-primary:hover {
        background-color: #0B5394;
        color: white;
    }

    /* Search and Filter Panel */
    .search-filter-panel {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
    }

    /* Search Box */
    .search-box-container {
        position: relative;
        margin-bottom: 20px;
    }

    .search-box {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-icon {
        position: absolute;
        left: 12px;
        color: #6c757d;
        font-size: 14px;
        z-index: 2;
    }

    #searchInput {
        width: 100%;
        padding: 12px 40px 12px 40px;
        border: 2px solid #0B5394;
        border-radius: 8px;
        font-size: 14px;
        background-color: white;
        transition: all 0.3s;
    }

    #searchInput:focus {
        outline: none;
        border-color: #073763;
        box-shadow: 0 0 0 3px rgba(11, 83, 148, 0.1);
    }

    .btn-search-clear {
        position: absolute;
        right: 8px;
        background: none;
        border: none;
        color: #6c757d;
        padding: 8px;
        cursor: pointer;
        border-radius: 4px;
    }

    .btn-search-clear:hover {
        background-color: #e9ecef;
    }

    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 8px 8px;
        z-index: 100;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .suggestion-item {
        padding: 12px 16px;
        cursor: pointer;
        font-size: 13px;
        color: #6c757d;
        border-bottom: 1px solid #f0f0f0;
    }

    .suggestion-item:hover {
        background-color: #f8f9fa;
        color: #0B5394;
    }

    .suggestion-item:last-child {
        border-bottom: none;
    }

    /* Quick Filters */
    .quick-filters {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filter-chip {
        padding: 8px 16px;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-chip:hover {
        border-color: #0B5394;
        color: #0B5394;
    }

    .filter-chip.active {
        background-color: #0B5394;
        color: white;
        border-color: #0B5394;
    }

    .filter-chip.urgent {
        border-color: #dc3545;
        color: #dc3545;
    }

    .filter-chip.urgent.active {
        background-color: #dc3545;
        color: white;
    }

    .chip-count {
        background-color: rgba(0,0,0,0.1);
        color: inherit;
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 600;
    }

    .filter-chip.active .chip-count {
        background-color: rgba(255,255,255,0.2);
    }

    /* Advanced Filters */
    .advanced-filters {
        border-top: 1px solid #dee2e6;
        padding-top: 20px;
    }

    .filters-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        padding: 10px 0;
        font-weight: 500;
        color: #495057;
    }

    .filters-toggle:hover {
        color: #0B5394;
    }

    .toggle-icon {
        transition: transform 0.3s;
    }

    .filters-toggle.expanded .toggle-icon {
        transform: rotate(180deg);
    }

    .filters-content {
        padding-top: 20px;
    }

    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-group label {
        font-size: 12px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-group input,
    .filter-group select {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 13px;
        background-color: white;
    }

    .date-range,
    .credit-range,
    .income-range {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .date-range input,
    .credit-range input,
    .income-range input {
        flex: 1;
    }

    .date-range span,
    .credit-range span,
    .income-range span {
        font-size: 13px;
        color: #6c757d;
    }

    .filter-actions {
        display: flex;
        gap: 10px;
    }

    /* Applications Summary */
    .applications-summary {
        margin-bottom: 20px;
    }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .stat-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 20px;
        text-align: center;
    }

    .stat-card.urgent {
        border-color: #dc3545;
        background-color: #fff5f5;
    }

    .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: #212529;
        display: block;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 13px;
        color: #6c757d;
        font-weight: 500;
        display: block;
        margin-bottom: 8px;
    }

    .stat-change {
        font-size: 12px;
        font-weight: 500;
    }

    .stat-change.positive {
        color: #28a745;
    }

    .stat-change.negative {
        color: #dc3545;
    }

    .stat-change.neutral {
        color: #6c757d;
    }

    /* Bulk Actions Bar */
    .bulk-actions-bar {
        background-color: #e3f2fd;
        border: 1px solid #90caf9;
        border-radius: 6px;
        padding: 15px 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .bulk-info {
        font-weight: 600;
        color: #0B5394;
    }

    .bulk-buttons {
        display: flex;
        gap: 10px;
    }

    .btn-bulk {
        padding: 6px 12px;
        background-color: #0B5394;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .btn-bulk:hover {
        background-color: #073763;
    }

    .btn-clear-selection {
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
    }

    .btn-clear-selection:hover {
        background-color: rgba(0,0,0,0.1);
    }

    /* Table Controls */
    .table-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }

    .view-options {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
    }

    .view-options label {
        font-weight: 500;
        color: #495057;
    }

    .view-options select {
        padding: 6px 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 13px;
    }

    .table-actions {
        display: flex;
        gap: 10px;
    }

    .btn-toggle {
        padding: 6px 12px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .btn-toggle:hover {
        background-color: #5a6268;
    }

    /* Data Table */
    .data-table {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    #applicationsTable {
        width: 100%;
        border-collapse: collapse;
        font-family: 'Inter', sans-serif;
    }

    #applicationsTable th {
        background-color: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-size: 12px;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
    }

    #applicationsTable th.sortable {
        cursor: pointer;
        user-select: none;
    }

    #applicationsTable th.sortable:hover {
        background-color: #e9ecef;
    }

    #applicationsTable th i {
        float: right;
        color: #adb5bd;
        font-size: 10px;
        margin-top: 2px;
    }

    #applicationsTable th.checkbox-col {
        width: 40px;
        text-align: center;
    }

    #applicationsTable td {
        padding: 15px 12px;
        font-size: 13px;
        color: #212529;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: top;
    }

    #applicationsTable tr:hover {
        background-color: #f8f9fa;
    }

    #applicationsTable tr.urgent {
        background-color: #fff5f5;
    }

    /* Applicant Info Styles */
    .applicant-info {
        min-width: 200px;
    }

    .applicant-primary {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }

    .applicant-primary strong {
        font-weight: 600;
        color: #212529;
    }

    .applicant-type {
        background-color: #e9ecef;
        color: #495057;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .applicant-contact {
        display: flex;
        flex-direction: column;
        gap: 2px;
        margin-bottom: 6px;
    }

    .applicant-contact span {
        font-size: 11px;
        color: #6c757d;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .applicant-contact i {
        width: 12px;
        text-align: center;
    }

    .co-applicants {
        font-size: 11px;
        color: #6c757d;
    }

    .co-applicant {
        background-color: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        display: inline-block;
    }

    /* Property Info Styles */
    .property-info {
        min-width: 180px;
    }

    .property-info strong {
        display: block;
        font-weight: 600;
        color: #212529;
        margin-bottom: 4px;
    }

    .unit-info {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
    }

    .unit-number {
        background-color: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: 600;
        font-size: 11px;
    }

    .rent-amount {
        color: #28a745;
        font-weight: 600;
        font-size: 12px;
    }

    .property-address {
        font-size: 11px;
        color: #6c757d;
    }

    /* Date Info Styles */
    .date-info strong {
        display: block;
        font-weight: 600;
        color: #212529;
        margin-bottom: 2px;
    }

    .time-info {
        font-size: 11px;
        color: #6c757d;
        margin-bottom: 2px;
    }

    .days-ago {
        font-size: 11px;
        color: #6c757d;
        font-style: italic;
    }

    /* Credit Score Styles */
    .credit-score {
        text-align: center;
        min-width: 80px;
    }

    .score-number {
        display: block;
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 2px;
    }

    .score-label {
        display: block;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .credit-score.excellent .score-number { color: #28a745; }
    .credit-score.excellent .score-label { color: #28a745; }
    .credit-score.good .score-number { color: #17a2b8; }
    .credit-score.good .score-label { color: #17a2b8; }
    .credit-score.fair .score-number { color: #ffc107; }
    .credit-score.fair .score-label { color: #856404; }
    .credit-score.poor .score-number { color: #dc3545; }
    .credit-score.poor .score-label { color: #dc3545; }

    .score-details {
        margin-top: 4px;
    }

    .score-details small {
        font-size: 10px;
        color: #6c757d;
    }

    /* Income Info Styles */
    .income-info {
        text-align: center;
        min-width: 100px;
    }

    .income-amount {
        display: block;
        font-size: 16px;
        font-weight: 600;
        color: #212529;
        margin-bottom: 4px;
    }

    .income-ratio {
        margin-bottom: 4px;
    }

    .income-ratio small {
        font-size: 10px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }

    .income-ratio.excellent small { color: #28a745; }
    .income-ratio.good small { color: #17a2b8; }
    .income-ratio.fair small { color: #ffc107; }
    .income-ratio.poor small { color: #dc3545; }

    .income-source {
        font-size: 11px;
        color: #6c757d;
    }

    /* Documents Status Styles */
    .documents-status {
        min-width: 120px;
    }

    .doc-progress {
        margin-bottom: 4px;
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        background-color: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 4px;
    }

    .progress-fill {
        height: 100%;
        background-color: #28a745;
        transition: width 0.3s;
    }

    .progress-text {
        font-size: 11px;
        font-weight: 600;
        color: #495057;
    }

    .missing-docs .warning {
        color: #dc3545;
        font-size: 10px;
    }

    .complete-docs .success {
        color: #28a745;
        font-size: 10px;
        font-weight: 600;
    }

    /* Status Container Styles */
    .status-container {
        text-align: center;
        min-width: 100px;
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: block;
        margin-bottom: 4px;
    }

    .status-pending {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-processing {
        background-color: #cce5ff;
        color: #004085;
    }

    .status-approved {
        background-color: #d4edda;
        color: #155724;
    }

    .status-denied {
        background-color: #f8d7da;
        color: #721c24;
    }

    .status-timeline {
        font-size: 10px;
        color: #6c757d;
    }

    /* Application Score Styles */
    .application-score {
        text-align: center;
        min-width: 60px;
    }

    .score-value {
        display: block;
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .application-score.excellent .score-value { color: #28a745; }
    .application-score.good .score-value { color: #17a2b8; }
    .application-score.fair .score-value { color: #ffc107; }
    .application-score.poor .score-value { color: #dc3545; }

    .score-breakdown {
        font-size: 9px;
        color: #6c757d;
    }

    .score-item {
        margin-bottom: 1px;
    }

    /* Action Buttons */
    .actions-cell {
        width: 120px;
    }

    .action-buttons {
        display: flex;
        gap: 4px;
        position: relative;
        justify-content: center;
    }

    .btn-action {
        width: 24px;
        height: 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        transition: all 0.2s;
    }

    .btn-review {
        background-color: #6c757d;
        color: white;
    }

    .btn-approve {
        background-color: #28a745;
        color: white;
    }

    .btn-deny {
        background-color: #dc3545;
        color: white;
    }

    .btn-processing {
        background-color: #17a2b8;
        color: white;
    }

    .btn-lease {
        background-color: #0B5394;
        color: white;
    }

    .btn-denied {
        background-color: #6c757d;
        color: white;
    }

    .btn-more {
        background-color: #e9ecef;
        color: #495057;
    }

    .btn-action:hover {
        transform: scale(1.1);
    }

    /* Action Dropdown */
    .action-dropdown {
        position: relative;
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        min-width: 150px;
        z-index: 1000;
        display: none;
    }

    .dropdown-menu.show {
        display: block;
    }

    .dropdown-menu a {
        display: block;
        padding: 8px 12px;
        font-size: 12px;
        color: #495057;
        text-decoration: none;
        border-bottom: 1px solid #f0f0f0;
    }

    .dropdown-menu a:hover {
        background-color: #f8f9fa;
        color: #0B5394;
    }

    .dropdown-menu a:last-child {
        border-bottom: none;
    }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
    }

    .pagination-info {
        font-size: 13px;
        color: #6c757d;
    }

    .pagination-controls {
        display: flex;
        gap: 5px;
    }

    .btn-page {
        width: 32px;
        height: 32px;
        border: 1px solid #dee2e6;
        background: white;
        color: #495057;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-page:hover:not(:disabled) {
        background-color: #e9ecef;
    }

    .btn-page.active {
        background-color: #0B5394;
        color: white;
        border-color: #0B5394;
    }

    .btn-page:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Override base.html nav-tabs styles for sub-navigation */
    .content-body .nav-tabs {
        border-bottom: 1px solid #dee2e6;
    }

    .content-body .nav-tabs .nav-link {
        color: #495057;
        background: transparent;
        border: 1px solid transparent;
        border-bottom: none;
        font-size: 13px;
        padding: 8px 16px;
        font-family: 'Inter', sans-serif;
    }

    .content-body .nav-tabs .nav-link:hover {
        border-color: #e9ecef #e9ecef #dee2e6;
        background: #f8f9fa;
    }

    .content-body .nav-tabs .nav-link.active {
        color: #495057;
        background: white;
        border-color: #dee2e6 #dee2e6 white;
        font-weight: 500;
    }
</style>

<script>
// Global variables
let selectedApplications = new Set();
let currentFilters = {
    quick: 'all',
    search: '',
    advanced: {}
};

// Search Functions
function performSearch() {
    const searchTerm = document.getElementById('searchInput').value;
    currentFilters.search = searchTerm;
    console.log('Searching for:', searchTerm);
    // In production, this would filter the table data
    filterApplications();
}

function expandSearch() {
    document.getElementById('searchSuggestions').style.display = 'block';
}

function collapseSearch() {
    setTimeout(() => {
        document.getElementById('searchSuggestions').style.display = 'none';
    }, 200);
}

function clearSearch() {
    document.getElementById('searchInput').value = '';
    currentFilters.search = '';
    filterApplications();
}

// Quick Filter Functions
function setQuickFilter(filterType) {
    // Update active state
    document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
    });
    event.target.classList.add('active');
    
    currentFilters.quick = filterType;
    console.log('Quick filter set to:', filterType);
    filterApplications();
}

// Advanced Filter Functions
function toggleAdvancedFilters() {
    const filtersContent = document.querySelector('.filters-content');
    const toggle = document.querySelector('.filters-toggle');
    const isVisible = filtersContent.style.display === 'block';
    
    if (isVisible) {
        filtersContent.style.display = 'none';
        toggle.classList.remove('expanded');
    } else {
        filtersContent.style.display = 'block';
        toggle.classList.add('expanded');
    }
}

function applyAdvancedFilters() {
    const filters = {
        dateFrom: document.getElementById('dateFrom').value,
        dateTo: document.getElementById('dateTo').value,
        property: Array.from(document.getElementById('propertyFilter').selectedOptions).map(o => o.value),
        creditMin: document.getElementById('creditMin').value,
        creditMax: document.getElementById('creditMax').value,
        incomeMin: document.getElementById('incomeMin').value,
        incomeMax: document.getElementById('incomeMax').value,
        source: document.getElementById('sourceFilter').value,
        documents: document.getElementById('documentsFilter').value
    };
    
    currentFilters.advanced = filters;
    console.log('Advanced filters applied:', filters);
    filterApplications();
}

function clearAdvancedFilters() {
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value = '';
    document.getElementById('propertyFilter').selectedIndex = -1;
    document.getElementById('creditMin').value = '';
    document.getElementById('creditMax').value = '';
    document.getElementById('incomeMin').value = '';
    document.getElementById('incomeMax').value = '';
    document.getElementById('sourceFilter').value = 'all';
    document.getElementById('documentsFilter').value = 'all';
    
    currentFilters.advanced = {};
    filterApplications();
}

function saveFilterPreset() {
    const name = prompt('Enter name for this filter preset:');
    if (name) {
        console.log('Saving filter preset:', name, currentFilters);
        showNotification('Filter preset saved successfully');
    }
}

// Main filter function
function filterApplications() {
    // In production, this would make an API call to filter applications
    console.log('Filtering applications with:', currentFilters);
    showNotification('Filters applied successfully');
}

// Table Functions
function changeViewMode() {
    const viewMode = document.getElementById('viewMode').value;
    console.log('Changing view mode to:', viewMode);
    // In production, this would change the table layout
    showNotification('View mode changed to ' + viewMode);
}

function applySorting() {
    const sortBy = document.getElementById('sortOptions').value;
    console.log('Sorting by:', sortBy);
    // In production, this would sort the table data
    showNotification('Table sorted by ' + sortBy);
}

function toggleSelectAll() {
    const allCheckboxes = document.querySelectorAll('.row-checkbox');
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    const shouldCheck = !selectAllCheckbox.checked;
    
    selectAllCheckbox.checked = shouldCheck;
    allCheckboxes.forEach(checkbox => {
        checkbox.checked = shouldCheck;
        if (shouldCheck) {
            selectedApplications.add(checkbox.value);
        } else {
            selectedApplications.delete(checkbox.value);
        }
    });
    
    updateBulkActionsBar();
}

function handleSelectAll() {
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    const allCheckboxes = document.querySelectorAll('.row-checkbox');
    
    allCheckboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
        if (selectAllCheckbox.checked) {
            selectedApplications.add(checkbox.value);
        } else {
            selectedApplications.delete(checkbox.value);
        }
    });
    
    updateBulkActionsBar();
}

function updateSelection() {
    const checkbox = event.target;
    if (checkbox.checked) {
        selectedApplications.add(checkbox.value);
    } else {
        selectedApplications.delete(checkbox.value);
    }
    
    // Update select all checkbox
    const allCheckboxes = document.querySelectorAll('.row-checkbox');
    const checkedCheckboxes = document.querySelectorAll('.row-checkbox:checked');
    const selectAllCheckbox = document.getElementById('selectAllCheckbox');
    selectAllCheckbox.checked = checkedCheckboxes.length === allCheckboxes.length;
    
    updateBulkActionsBar();
}

function updateBulkActionsBar() {
    const bulkBar = document.getElementById('bulkActionsBar');
    const selectedCount = document.getElementById('selectedCount');
    
    if (selectedApplications.size > 0) {
        bulkBar.style.display = 'flex';
        selectedCount.textContent = selectedApplications.size;
    } else {
        bulkBar.style.display = 'none';
    }
}

function clearSelection() {
    selectedApplications.clear();
    document.querySelectorAll('.row-checkbox').forEach(checkbox => {
        checkbox.checked = false;
    });
    document.getElementById('selectAllCheckbox').checked = false;
    updateBulkActionsBar();
}

// Bulk Action Functions
function bulkApprove() {
    if (selectedApplications.size === 0) return;
    
    if (confirm(`Approve ${selectedApplications.size} application(s)?`)) {
        console.log('Bulk approving applications:', Array.from(selectedApplications));
        showNotification(`${selectedApplications.size} application(s) approved`);
        clearSelection();
    }
}

function bulkDeny() {
    if (selectedApplications.size === 0) return;
    
    const reason = prompt('Enter denial reason:');
    if (reason) {
        console.log('Bulk denying applications:', Array.from(selectedApplications), 'Reason:', reason);
        showNotification(`${selectedApplications.size} application(s) denied`);
        clearSelection();
    }
}

function bulkRequestDocuments() {
    if (selectedApplications.size === 0) return;
    
    console.log('Requesting documents from:', Array.from(selectedApplications));
    showNotification(`Document requests sent to ${selectedApplications.size} applicant(s)`);
}

function bulkSendEmails() {
    if (selectedApplications.size === 0) return;
    
    console.log('Sending emails to:', Array.from(selectedApplications));
    window.location.href = `/applications/bulk-email?ids=${Array.from(selectedApplications).join(',')}`;
}

function bulkExport() {
    if (selectedApplications.size === 0) return;
    
    console.log('Exporting applications:', Array.from(selectedApplications));
    showNotification(`Exporting ${selectedApplications.size} application(s)`);
}

// Individual Application Actions
function reviewApplication(id) {
    console.log('Reviewing application:', id);
    window.location.href = `/applications/review/${id}`;
}

function quickApprove(id) {
    if (confirm('Approve this application?')) {
        console.log('Quick approving application:', id);
        showNotification('Application approved successfully');
        // Update row status
        updateApplicationStatus(id, 'approved');
    }
}

function quickDeny(id) {
    const reason = prompt('Enter denial reason:');
    if (reason) {
        console.log('Quick denying application:', id, 'Reason:', reason);
        showNotification('Application denied');
        // Update row status
        updateApplicationStatus(id, 'denied');
    }
}

function createLease(id) {
    if (confirm('Create lease for this approved application?')) {
        console.log('Creating lease for application:', id);
        window.location.href = `/leases/create?application_id=${id}`;
    }
}

function viewProcessing(id) {
    console.log('Viewing processing status for application:', id);
    window.location.href = `/applications/processing/${id}`;
}

function viewDenialReason(id) {
    console.log('Viewing denial reason for application:', id);
    // In production, this would show a modal with denial details
    alert('Denied due to insufficient income and poor credit history');
}

// Action Menu Functions
function toggleActionMenu(id) {
    // Close all other menus first
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
        if (menu.id !== `actionMenu${id}`) {
            menu.classList.remove('show');
        }
    });
    
    // Toggle current menu
    const menu = document.getElementById(`actionMenu${id}`);
    menu.classList.toggle('show');
}

// Close action menus when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.action-dropdown')) {
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            menu.classList.remove('show');
        });
    }
});

// Additional Functions
function requestDocuments(id) {
    console.log('Requesting documents from application:', id);
    window.location.href = `/applications/request-documents/${id}`;
}

function scheduleShowing(id) {
    console.log('Scheduling showing for application:', id);
    window.location.href = `/showings/schedule?application_id=${id}`;
}

function sendEmail(id) {
    console.log('Sending email to application:', id);
    window.location.href = `/applications/email/${id}`;
}

function addNote(id) {
    const note = prompt('Enter note:');
    if (note) {
        console.log('Adding note to application:', id, 'Note:', note);
        showNotification('Note added successfully');
    }
}

function expediteProcessing(id) {
    if (confirm('Expedite processing for this application?')) {
        console.log('Expediting processing for application:', id);
        showNotification('Application processing expedited');
    }
}

function sendApprovalLetter(id) {
    console.log('Sending approval letter for application:', id);
    showNotification('Approval letter sent');
}

function scheduleMovein(id) {
    console.log('Scheduling move-in for application:', id);
    window.location.href = `/move-ins/schedule?application_id=${id}`;
}

function sendDenialLetter(id) {
    console.log('Sending denial letter for application:', id);
    showNotification('Denial letter sent');
}

function reconsiderApplication(id) {
    if (confirm('Reconsider this denied application?')) {
        console.log('Reconsidering application:', id);
        showNotification('Application moved back to pending review');
        updateApplicationStatus(id, 'pending');
    }
}

function archiveApplication(id) {
    if (confirm('Archive this application?')) {
        console.log('Archiving application:', id);
        showNotification('Application archived');
    }
}

function duplicateApplication(id) {
    console.log('Duplicating application:', id);
    window.location.href = `/applications/duplicate/${id}`;
}

function deleteApplication(id) {
    if (confirm('Are you sure you want to delete this application? This cannot be undone.')) {
        console.log('Deleting application:', id);
        showNotification('Application deleted');
        // Remove row from table
        document.querySelector(`tr[data-id="${id}"]`).remove();
    }
}

// Header Action Functions
function newApplication() {
    console.log('Creating new application');
    window.location.href = '/applications/new';
}

function importApplications() {
    console.log('Importing applications');
    window.location.href = '/applications/import';
}

function exportApplications() {
    console.log('Exporting applications');
    showNotification('Export started - you will receive an email when complete');
}

function refreshApplications() {
    console.log('Refreshing applications');
    location.reload();
}

// Utility Functions
function updateApplicationStatus(id, status) {
    // In production, this would make an API call
    console.log('Updating application status:', id, 'to', status);
    
    // Update the row visually
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (row) {
        row.dataset.status = status;
        const statusBadge = row.querySelector('.status-badge');
        statusBadge.className = `status-badge status-${status}`;
        statusBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
    }
}

function showNotification(message) {
    // Create notification element
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        font-size: 14px;
        z-index: 10000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    updateBulkActionsBar();
    
    // Set up sortable headers
    document.querySelectorAll('th.sortable').forEach(header => {
        header.addEventListener('click', function() {
            const sortKey = this.dataset.sort;
            console.log('Sorting by:', sortKey);
            // Update sort icons and apply sorting
        });
    });
    
    // Add suggestion click handlers
    document.querySelectorAll('.suggestion-item').forEach(item => {
        item.addEventListener('click', function() {
            document.getElementById('searchInput').value = this.textContent;
            performSearch();
            collapseSearch();
        });
    });
});
</script>
{% endblock %}

{% block contextsidebar %}
<h5><i class="fas fa-file-alt"></i> Applications</h5>
<div class="menu-item starred-item">Tasks</div>
<div class="menu-item">New Application</div>
<div class="menu-item">Bulk Approve</div>
<div class="menu-item">Request Documents</div>
<div class="menu-item">Credit Check Batch</div>
<div class="menu-item">Import Applications</div>

<div class="task-section">
    <div class="task-section-title">Processing</div>
    <div class="menu-item">Review Pending</div>
    <div class="menu-item">Background Checks</div>
    <div class="menu-item">Reference Checks</div>
    <div class="menu-item">Income Verification</div>
</div>

<div class="task-section">
    <div class="task-section-title">Reports</div>
    <div class="menu-item">Application Summary</div>
    <div class="menu-item">Approval Rate Analysis</div>
    <div class="menu-item">Source Performance</div>
    <div class="menu-item">Time to Process</div>
</div>

<div class="support-section">
    <h5><i class="fas fa-question-circle"></i> Help Topics</h5>
    <div class="menu-item">Application Process Guide</div>
    <div class="menu-item">Fair Housing Laws</div>
</div>
{% endblock %}

{% block taskssidebar %}
<h5><i class="fas fa-tasks"></i> Application Actions</h5>

<div class="task-item starred-item">Tasks</div>

<div class="task-section">
    <div class="task-section-title">Quick Actions</div>
    <a href="#" onclick="newApplication()" class="task-item">New Application</a>
    <a href="#" onclick="bulkApprove()" class="task-item">Bulk Approve</a>
    <a href="#" onclick="bulkRequestDocuments()" class="task-item">Request Documents</a>
    <a href="#" onclick="exportApplications()" class="task-item">Export Applications</a>
</div>

<div class="task-section">
    <div class="task-section-title">Processing</div>
    <a href="#" class="task-item">Run Credit Checks</a>
    <a href="#" class="task-item">Verify Income</a>
    <a href="#" class="task-item">Check References</a>
    <a href="#" class="task-item">Background Screening</a>
</div>

<div class="task-section">
    <div class="task-section-title">Templates</div>
    <a href="#" class="task-item">Approval Letter</a>
    <a href="#" class="task-item">Denial Letter</a>
    <a href="#" class="task-item">Document Request</a>
    <a href="#" class="task-item">Application Form</a>
</div>

<div class="task-section">
    <div class="task-section-title">Reports</div>
    <a href="{{ url_for('reports') }}" class="task-item">Application Summary</a>
    <a href="{{ url_for('reports') }}" class="task-item">Approval Rate Report</a>
    <a href="{{ url_for('reports') }}" class="task-item">Source Analysis</a>
</div>

<div class="support-section">
    <h5><i class="fas fa-life-ring"></i> Support</h5>
    <div class="task-item">Application Process Guide</div>
    <div class="task-item">Contact Support</div>
</div>
{% endblock %}