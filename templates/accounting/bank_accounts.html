{% extends "base.html" %}

{% block title %}Bank Accounts - Property Management{% endblock %}

{% block content %}
<div class="content-header">
    <h2>Bank Accounts</h2>
</div>

<div class="content-body">
    <!-- Sub-navigation tabs for Accounting section -->
    <ul class="nav nav-tabs mb-3" style="background: white; padding: 10px 10px 0; border-radius: 4px 4px 0 0;">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('receivables') }}">Receivables</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('payables') }}">Payables</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('bank_accounts') }}">Bank Accounts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('journal_entries') }}">Journal Entries</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('bank_transfers') }}">Bank Transfers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('gl_accounts') }}">GL Accounts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('diagnostics') }}">Diagnostics</a>
        </li>
    </ul>

    <div class="bank-accounts-container">
        <!-- Bank Changes In Progress Alert -->
        <div class="bank-changes-alert">
            <h3>Bank Changes In Progress</h3>
            <div class="bank-changes-content">
                <div class="bank-change-item">
                    <strong>Eaton Apartments</strong><br>
                    <span class="text-muted">operating</span>
                </div>
                <div class="arrow">→</div>
                <div class="bank-change-item">
                    <strong>Eaton Escrow</strong><br>
                    <span class="text-muted">Properties<br>1 Property</span>
                </div>
                <div class="bank-change-action">
                    <button class="btn btn-primary btn-sm">Continue</button>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <input type="text" class="filter-input" placeholder="Account Name">
            <input type="text" class="filter-input" placeholder="Bank">
            <button class="btn btn-outline-primary btn-sm">More Filters...</button>
            <button class="btn btn-outline-secondary btn-sm">Clear Filters</button>
        </div>

        <!-- Data Table -->
        <div class="data-table">
            <table>
                <thead>
                    <tr>
                        <th>Account Name <span class="sort-icon">↕</span></th>
                        <th>Bank <span class="sort-icon">↕</span></th>
                        <th>Account Number <span class="sort-icon">↕</span></th>
                        <th>Last Reconciliation <span class="sort-icon">↕</span></th>
                        <th>Payments Enabled <span class="sort-icon">↕</span></th>
                        <th>Auto-Reconciliation <span class="sort-icon">↕</span></th>
                    </tr>
                </thead>
                <tbody>
                    {% if accounts %}
                        {% for account in accounts %}
                        <tr>
                            <td class="account-name">{{ account.name }}</td>
                            <td>{{ account.bank }}</td>
                            <td>{{ account.account_number }}</td>
                            <td>{{ account.last_reconciliation }}</td>
                            <td>
                                {% if account.payments_enabled == 'ENABLED' %}
                                    <span class="status-enabled">ENABLED</span>
                                {% else %}
                                    <span class="status-disabled">NOT ENABLED</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if account.auto_reconciliation == 'PLAID' %}
                                    <span class="status-enabled">PLAID</span>
                                {% else %}
                                    <span class="status-disabled">NOT ENABLED</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <!-- Sample data for demonstration -->
                        <tr>
                            <td class="account-name">3825 Baltimore / Finkelstein</td>
                            <td>US Bank</td>
                            <td>********2041</td>
                            <td>07/31/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">40th St Escrow</td>
                            <td>US Bank</td>
                            <td>********7206</td>
                            <td>11/30/2021</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">40th st property</td>
                            <td>US Bank</td>
                            <td>********3228</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">AC Equity, LLC / Highland</td>
                            <td>US Bank</td>
                            <td>********2234</td>
                            <td>07/31/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Aspen Village Apts/EM2 Investments, LLC</td>
                            <td>Bank of America</td>
                            <td>********0610</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Barton Crossing/Flint</td>
                            <td>Arvest</td>
                            <td>****1304</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Blue Ridge Manor</td>
                            <td>US Bank</td>
                            <td>********1556</td>
                            <td>07/31/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Booth Apartments / Michael Sullivan</td>
                            <td>US Bank</td>
                            <td>********6994</td>
                            <td>07/31/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Booth Apts / FBB</td>
                            <td>First Business Bank</td>
                            <td>****3934</td>
                            <td>08/01/2020</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Brentwood park / escrow</td>
                            <td>US Bank</td>
                            <td>********6928</td>
                            <td>04/30/2020</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Brentwood Park / Operating</td>
                            <td>US Bank</td>
                            <td>********6910</td>
                            <td>04/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Brentwood Park Ventures Const Res</td>
                            <td>US Bank</td>
                            <td>********6340</td>
                            <td>06/30/2021</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Castle Row Apts/EM2 Investments, LLC</td>
                            <td>Bank of America</td>
                            <td>********0449</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Charlotte Park Apartments LLC</td>
                            <td>UMB Bank</td>
                            <td>********6025</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">CP001 Dummy</td>
                            <td>US Bank</td>
                            <td>********9646</td>
                            <td>01/01/2012</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Eaton Apartments operating</td>
                            <td>NBKC</td>
                            <td>***0625</td>
                            <td>06/30/2025</td>
                            <td><span class="status-enabled">ENABLED</span></td>
                            <td><span class="status-enabled">PLAID</span></td>
                        </tr>
                        <tr>
                            <td class="account-name">Eaton Escrow</td>
                            <td>NBKC</td>
                            <td>*3084</td>
                            <td>01/17/2024</td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                            <td><span class="status-disabled">NOT ENABLED</span></td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .bank-accounts-container {
        background-color: white;
        border-radius: 4px;
        padding: 20px;
    }

    .bank-changes-alert {
        background: #fff3cd;
        border: 1px solid #ffc107;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    .bank-changes-alert h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #856404;
    }

    .bank-changes-content {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .bank-change-item {
        flex: 0 0 auto;
    }

    .bank-change-item strong {
        color: #212529;
    }

    .text-muted {
        color: #6c757d;
        font-size: 11px;
    }

    .arrow {
        font-size: 20px;
        color: #856404;
    }

    .bank-change-action {
        margin-left: auto;
    }

    .filter-section {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        align-items: center;
    }

    .filter-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    .filter-input:focus {
        outline: none;
        border-color: #0B5394;
        box-shadow: 0 0 0 2px rgba(11, 83, 148, 0.1);
    }

    .btn-outline-primary {
        color: #0B5394;
        border: 1px solid #0B5394;
        background: white;
    }

    .btn-outline-primary:hover {
        background: #0B5394;
        color: white;
    }

    .btn-outline-secondary {
        color: #6c757d;
        border: 1px solid #dee2e6;
        background: #f8f9fa;
    }

    .btn-outline-secondary:hover {
        background: #e9ecef;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 3px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .account-name {
        color: #0B5394;
        font-weight: 500;
        cursor: pointer;
    }

    .account-name:hover {
        text-decoration: underline;
    }

    .status-enabled {
        color: #28a745;
        font-weight: 600;
        font-size: 12px;
    }

    .status-disabled {
        color: #dc3545;
        font-weight: 600;
        font-size: 12px;
    }

    .sort-icon {
        font-size: 10px;
        color: #6c757d;
        margin-left: 5px;
    }

    /* Override base.html nav-tabs styles for sub-navigation */
    .content-body .nav-tabs {
        border-bottom: 1px solid #dee2e6;
    }

    .content-body .nav-tabs .nav-link {
        color: #495057;
        background: transparent;
        border: 1px solid transparent;
        border-bottom: none;
        font-size: 13px;
        padding: 8px 16px;
    }

    .content-body .nav-tabs .nav-link:hover {
        border-color: #e9ecef #e9ecef #dee2e6;
        background: #f8f9fa;
    }

    .content-body .nav-tabs .nav-link.active {
        color: #495057;
        background: white;
        border-color: #dee2e6 #dee2e6 white;
        font-weight: 500;
    }

    /* Data table specific styles */
    .data-table {
        margin-top: 0;
    }

    .data-table th {
        cursor: pointer;
        user-select: none;
    }

    .data-table th:hover {
        background-color: #e9ecef;
    }

    .data-table table {
        width: 100%;
    }

    .data-table tbody tr:hover {
        background-color: #f8f9fa;
    }
</style>

<script>
    // Sort functionality
    document.querySelectorAll('th').forEach(header => {
        if (header.querySelector('.sort-icon')) {
            header.addEventListener('click', function() {
                console.log('Sorting by:', this.textContent);
                // Implement sorting logic here
            });
        }
    });

    // Filter functionality
    document.querySelectorAll('.filter-input').forEach(input => {
        input.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                console.log('Filtering by:', this.placeholder, '=', this.value);
                // Implement filtering logic here
            }
        });
    });

    // Account name click handler
    document.querySelectorAll('.account-name').forEach(name => {
        name.addEventListener('click', function() {
            console.log('Opening account details for:', this.textContent);
            // Navigate to account details
        });
    });
</script>
{% endblock %}
