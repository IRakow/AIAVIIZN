{% extends "base.html" %}

{% block title %}Financial Diagnostics - Property Management{% endblock %}

{% block content %}
<div class="content-header">
    <h2>Financial Diagnostics</h2>
</div>

<div class="content-body">
    <!-- Sub-navigation tabs for Accounting section -->
    <ul class="nav nav-tabs mb-3" style="background: white; padding: 10px 10px 0; border-radius: 4px 4px 0 0;">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('receivables') }}">Receivables</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('payables') }}">Payables</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('bank_accounts') }}">Bank Accounts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('journal_entries') }}">Journal Entries</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('bank_transfers') }}">Bank Transfers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('gl_accounts') }}">GL Accounts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('diagnostics') }}">Diagnostics</a>
        </li>
    </ul>

    <div class="diagnostics-container">
        <!-- Filter Section -->
        <div class="filter-section">
            <p style="font-weight: 500; margin-bottom: 15px;">To view for all properties, click Search, or filter by property below.</p>
            <div class="filter-controls">
                <input type="text" class="filter-input" placeholder="Properties" style="flex: 2;">
                <select class="filter-select">
                    <option>Show All Properties</option>
                </select>
                <button class="btn btn-primary btn-sm">Search</button>
            </div>
        </div>

        <!-- Security Deposit Funds Mismatch -->
        <div class="diagnostic-section">
            <div class="section-header" onclick="toggleDiagnosticSection(this)">
                <span class="section-arrow">▼</span>
                <span class="section-title">Security Deposit Funds Mismatch ⓘ</span>
            </div>
            <div class="section-content">
                <table class="diagnostic-table">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Deposit Account Balance (General Ledger) ⓘ</th>
                            <th>Deposit Account Balance (Security Deposit Funds) ⓘ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="property-link">(BARR) Rock Ridge Ranch Apartments</td>
                            <td style="text-align: right;">34,692.00</td>
                            <td style="text-align: right;">35,073.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">3739 Wyandotte Apartments</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">4,250.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">4504 Terrace / Cottone Properties LLC</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">600.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">BAR Wyandotte / BAR Wyandotte LLC</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">12,000.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Bella Condo</td>
                            <td style="text-align: right;">600.00</td>
                            <td style="text-align: right;">0.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Brushwood Apts / Brush Creek Holdings LLC</td>
                            <td style="text-align: right;">10,686.50</td>
                            <td style="text-align: right;">9,733.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Highland / Highland Ventures</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">5,097.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Kaanapali Apartments / BAR Development LLC</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">7,300.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">La Casa / KC Virginia LLC</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">4,300.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Lincrest Apts / Linwood Holdings LLC</td>
                            <td style="text-align: right;">15,993.75</td>
                            <td style="text-align: right;">9,600.00</td>
                        </tr>
                        <tr>
                            <td class="property-link">Shadow Creek Apartments</td>
                            <td style="text-align: right;">10,516.00</td>
                            <td style="text-align: right;">10,366.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Escrow Cash Account Balance Mismatch -->
        <div class="diagnostic-section">
            <div class="section-header" onclick="toggleDiagnosticSection(this)">
                <span class="section-arrow">▼</span>
                <span class="section-title">Escrow Cash Account Balance Mismatch ⓘ</span>
            </div>
            <div class="section-content">
                <table class="diagnostic-table">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Escrow Cash GL Balance ⓘ</th>
                            <th>Deposit GL Accounts ⓘ</th>
                            <th>All GL Accounts w/ Escrow Cash Offset ⓘ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="property-link">(BARR) Rock Ridge Ranch Apartments</td>
                            <td style="text-align: right;">246,927.56</td>
                            <td style="text-align: right;">0.00</td>
                            <td style="text-align: right;">0.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    .diagnostics-container {
        background-color: white;
        border-radius: 4px;
        padding: 20px;
    }

    .filter-section {
        background: white;
        border: 2px solid #0B5394;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        position: relative;
    }

    .filter-section::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-top: 10px solid #0B5394;
    }

    .filter-controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .filter-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
    }

    .filter-select {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
        min-width: 180px;
    }

    .diagnostic-section {
        margin-bottom: 20px;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        overflow: hidden;
    }

    .section-header {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background: #f8f9fa;
        border-left: 4px solid #0B5394;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .section-header:hover {
        background: #e9ecef;
    }

    .section-arrow {
        margin-right: 10px;
        transition: transform 0.3s;
    }

    .section-arrow.collapsed {
        transform: rotate(-90deg);
    }

    .section-title {
        flex: 1;
    }

    .section-content {
        padding: 15px;
        background: white;
    }

    .section-content.collapsed {
        display: none;
    }

    .diagnostic-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }

    .diagnostic-table th {
        background: #f8f9fa;
        padding: 10px;
        text-align: left;
        font-weight: 500;
        border-bottom: 2px solid #dee2e6;
    }

    .diagnostic-table td {
        padding: 10px;
        border-bottom: 1px solid #e9ecef;
    }

    .diagnostic-table tr:hover {
        background: #f8f9fa;
    }

    .property-link {
        color: #0B5394;
        cursor: pointer;
    }

    .property-link:hover {
        text-decoration: underline;
    }

    /* Override base.html nav-tabs styles for sub-navigation */
    .content-body .nav-tabs {
        border-bottom: 1px solid #dee2e6;
    }

    .content-body .nav-tabs .nav-link {
        color: #495057;
        background: transparent;
        border: 1px solid transparent;
        border-bottom: none;
        font-size: 13px;
        padding: 8px 16px;
    }

    .content-body .nav-tabs .nav-link:hover {
        border-color: #e9ecef #e9ecef #dee2e6;
        background: #f8f9fa;
    }

    .content-body .nav-tabs .nav-link.active {
        color: #495057;
        background: white;
        border-color: #dee2e6 #dee2e6 white;
        font-weight: 500;
    }
</style>

<script>
    function toggleDiagnosticSection(header) {
        const arrow = header.querySelector('.section-arrow');
        const content = header.nextElementSibling;
        
        if (arrow.classList.contains('collapsed')) {
            arrow.classList.remove('collapsed');
            content.classList.remove('collapsed');
        } else {
            arrow.classList.add('collapsed');
            content.classList.add('collapsed');
        }
    }
</script>
{% endblock %}