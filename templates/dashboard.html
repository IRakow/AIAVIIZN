{% extends 'base.html' %}

{% block title %}Dashboard - AIVIIZN{% endblock %}

{% block content %}
<div class="content-header">
    <div class="d-flex justify-content-between align-items-center">
        <h2>Dashboard</h2>
        <div class="d-flex gap-2">
            <select class="form-select form-select-sm" style="width: auto;">
                <option>View By: All</option>
                <option>View By: Property</option>
                <option>View By: Portfolio</option>
            </select>
            <button class="btn btn-sm btn-primary">
                <i class="fas fa-cog"></i> Customize
            </button>
        </div>
    </div>
</div>

<div class="content-body" style="padding: 15px; background: #f8f9fa;">
    <!-- Financial Diagnostics Alert -->
    <div class="alert alert-info alert-dismissible fade show" role="alert" style="background: #d1ecf1; border: 1px solid #bee5eb; font-size: 13px;">
        <i class="fas fa-info-circle"></i>
        Have you checked your Financial Diagnostics Page recently? 
        <a href="{{ url_for('diagnostics') }}" class="alert-link">Click here</a> to check up on your Financial Health. 
        <a href="#" class="alert-link">Remind me in 7 days</a> | 
        <a href="#" class="alert-link">I'm fine... don't show this message again</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert" style="font-size: 10px;"></button>
    </div>

    <!-- Loading Skeleton -->
    <div id="loadingSkeleton" style="display: block;">
        <div class="skeleton-container">
            <div class="skeleton-box" style="height: 200px; margin-bottom: 20px;"></div>
            <div class="skeleton-box" style="height: 150px; margin-bottom: 20px;"></div>
            <div class="skeleton-box" style="height: 300px;"></div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div id="dashboardContent" style="display: none;">
        
        <!-- Move Ins Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('moveIns')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow" style="display: inline-block; transition: transform 0.3s;">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Move Ins</span>
            </div>
            <div id="moveIns" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 15px;">
                <div class="update-notice" style="background: #e8f4fd; border: 1px solid #bee5eb; padding: 15px; border-radius: 4px; margin-bottom: 15px;">
                    <div class="d-flex align-items-start">
                        <span class="badge bg-info me-2">NEW</span>
                        <div class="flex-grow-1">
                            <strong>Move Ins Updated</strong>
                            <p class="mb-2 mt-2" style="font-size: 13px;">We've added some key information to help track the progress of your move-ins. What additional information would you like to see?</p>
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-comment"></i> FEEDBACK
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="search-box text-center mb-3" style="padding: 15px; background: #f8f9fa; border-radius: 4px;">
                    <div style="position: relative; display: inline-block; width: 60%;">
                        <input type="text" class="form-control" placeholder="Search by property, unit or group" style="border-radius: 20px;">
                        <div style="position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid #f8f9fa;"></div>
                    </div>
                </div>

                <div class="table-controls mb-2 d-flex justify-content-between align-items-center">
                    <input type="text" class="form-control form-control-sm" placeholder="Search by property, unit or group" style="width: 300px;">
                    <select class="form-select form-select-sm" style="width: 150px;">
                        <option>Lease Status</option>
                        <option>Active</option>
                        <option>Pending</option>
                    </select>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showFinished">
                        <label class="form-check-label" for="showFinished" style="font-size: 13px;">
                            Show Finished Move Ins
                        </label>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-sm table-hover" style="font-size: 12px;">
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th>Future Tenant ↕</th>
                                <th>Property - Unit ↕</th>
                                <th>Lease ↕</th>
                                <th>Portal ↕</th>
                                <th>Balance ↕</th>
                                <th>Insurance</th>
                                <th>Move In Date ↕</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="color: #0066cc;">Sainge, Samuel</td>
                                <td>-</td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>$400.00</td>
                                <td><span class="text-danger">Not Covered</span></td>
                                <td>07/25/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Bell, Telia R.</td>
                                <td>-</td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>$0.00</td>
                                <td><span class="text-danger">Not Covered</span></td>
                                <td>08/01/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Carlson, Eric A.</td>
                                <td>Campbell Apartments - 3403 #4</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$727.74</td>
                                <td><span class="text-success">Covered</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Stivers, Rachel A.</td>
                                <td>Grandview 17 Townhomes / Grandview 17 KC LLC - 13825 A</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$930.92</td>
                                <td><span class="text-warning">Pending</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Yoder, Julianna R.</td>
                                <td>Villas of Mur-Len / TSI Villas of Mur-Len - 205 U</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>$807.04</td>
                                <td><span class="text-success">Covered</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Ventura Sarmiento, Reiman</td>
                                <td>(BARR) Rock Ridge Ranch Apartments - 59A</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$607.74</td>
                                <td><span class="text-success">Covered</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Patterson, Shyanne J.</td>
                                <td>Aspen Village Apartments - 3610 #02</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$706.40</td>
                                <td><span class="text-warning">Pending</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Goodwin, Marcel L.</td>
                                <td>(BARR) Rock Ridge Ranch Apartments - 69A-R</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$923.18</td>
                                <td><span class="text-warning">Pending</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Harvey, Alahzeyai S.</td>
                                <td>Eaton Apartments / D&T - 3001</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td class="text-success">-$927.05</td>
                                <td><span class="text-warning">Pending</span></td>
                                <td>08/08/2025</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Castro, Laura L.</td>
                                <td>Eaton Apartments / D&T - 3043</td>
                                <td><span class="badge bg-primary">Fully Executed</span></td>
                                <td></td>
                                <td>$0.00</td>
                                <td><span class="text-warning">Pending</span></td>
                                <td>08/11/2025</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2" style="font-size: 12px;">
                    <span>Displaying: 1-10 of 25</span>
                    <div class="pagination-controls">
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;"><<</button>
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;"><</button>
                        <span class="mx-2">1 2 3</span>
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;">></button>
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;">>></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Move Outs Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('moveOuts')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Move Outs</span>
            </div>
            <div id="moveOuts" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 15px;">
                <div class="table-responsive">
                    <table class="table table-sm table-hover" style="font-size: 12px;">
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th>Tenant Name ↕</th>
                                <th>Move Out Type ↕</th>
                                <th>Property - Unit ↕</th>
                                <th>Move Out Date ↕</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="color: #0066cc;">Jones, Alisa</td>
                                <td>All Tenants</td>
                                <td>Walnut Ridge Apts - 6118-C</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Mitchell, Cameron M.</td>
                                <td>All Tenants</td>
                                <td>Gene Field Apts / DW Gene Field LLC / Ryan Deutsch - 04-07</td>
                                <td>96 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Crawford, Susan</td>
                                <td>All Tenants</td>
                                <td>Homestead Villas 4-Plex - 4838 Terr</td>
                                <td>32 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Wilson, Amelia J.</td>
                                <td>All Tenants</td>
                                <td>Valentine Apartments - 3747 #03</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Craddock, Jaylen C.</td>
                                <td>All Tenants</td>
                                <td>Aspen Village Apartments - 3610 #04</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Edwards, Amber L.</td>
                                <td>All Tenants</td>
                                <td>3825 Baltimore - 3827 #02</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Zhang, Weijie</td>
                                <td>All Tenants</td>
                                <td>Eaton Apartments / D&T - 3003</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Matthews, Donald</td>
                                <td>All Tenants</td>
                                <td>Longmeadow Apartments - #15B</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Forson, Kayla</td>
                                <td>All Tenants</td>
                                <td>Walnut Ridge Apts - 6110 1/2 A NW Bell Rd.</td>
                                <td>7 days ago</td>
                            </tr>
                            <tr>
                                <td style="color: #0066cc;">Smothers, Seth T.</td>
                                <td>All Tenants</td>
                                <td>Charlotte Park Apartments - 803 #1E</td>
                                <td>7 days ago</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2" style="font-size: 12px;">
                    <span>Displaying: 1-10 of 50</span>
                    <div class="pagination-controls">
                        <span class="mx-2">1 2 3 4 5</span>
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;">></button>
                        <button class="btn btn-sm btn-outline-secondary" style="padding: 2px 8px;">>></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Online Payments Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('onlinePayments')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Online Payments</span>
            </div>
            <div id="onlinePayments" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="row mb-3">
                    <div class="col-md-12">
                        <h6 style="font-size: 13px; color: #6c757d;">Online Payment Statistics <i class="fas fa-info-circle text-info"></i></h6>
                        <div class="d-flex align-items-center gap-4">
                            <div class="stat-box">
                                <h2 style="color: #0891b2; font-size: 36px; margin: 0;">90%</h2>
                                <p style="font-size: 12px; color: #6c757d; margin: 0;">Payments Collected Online</p>
                                <a href="#" style="font-size: 11px;">View history</a>
                            </div>
                            <div style="height: 60px; width: 2px; background: #dee2e6;"></div>
                            <div class="stat-box">
                                <h2 style="color: #0891b2; font-size: 36px; margin: 0;">92%</h2>
                                <p style="font-size: 12px; color: #6c757d; margin: 0;">Units Paid Online</p>
                                <a href="#" style="font-size: 11px;">View history</a>
                            </div>
                        </div>
                        <p style="font-size: 12px; margin-top: 10px;">Want to increase Online Payments? <a href="#">See who's not paying online</a></p>
                    </div>
                </div>

                <div class="online-portal-adoption" style="margin-top: 20px;">
                    <h6 style="font-size: 13px; margin-bottom: 15px;">Online Portal Adoption</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <div style="background: #e6f7ff; padding: 20px; border-radius: 8px; text-align: center;">
                                <h3 style="color: #0891b2; font-size: 48px; margin: 0;">90%</h3>
                                <p style="font-size: 11px; text-transform: uppercase; color: #6c757d; margin-top: 10px;">ACTIVATED</p>
                                <a href="#" style="font-size: 11px;">View Tenants</a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="background: #fff4e6; padding: 20px; border-radius: 8px; text-align: center;">
                                <h3 style="color: #f59e0b; font-size: 48px; margin: 0;">5%</h3>
                                <p style="font-size: 11px; text-transform: uppercase; color: #6c757d; margin-top: 10px;">NON-ACTIVATED <i class="fas fa-exclamation-circle"></i></p>
                                <a href="#" style="font-size: 11px;">Send Activation Emails</a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="background: #fee; padding: 20px; border-radius: 8px; text-align: center;">
                                <h3 style="color: #ef4444; font-size: 48px; margin: 0;">5%</h3>
                                <p style="font-size: 11px; text-transform: uppercase; color: #6c757d; margin-top: 10px;">NO EMAIL <i class="fas fa-exclamation-circle"></i></p>
                                <a href="#" style="font-size: 11px;">View Tenants</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('notifications')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Notifications</span>
            </div>
            <div id="notifications" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="row">
                    <div class="col-md-4">
                        <h6 style="font-size: 13px;">Activities</h6>
                        <div class="d-flex align-items-center gap-3">
                            <h3 style="color: #0891b2; font-size: 36px; margin: 0;">24</h3>
                            <span style="font-size: 12px; color: #6c757d;">Due in the next 7 days</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6 style="font-size: 13px;">Bills</h6>
                        <div class="d-flex align-items-center gap-3">
                            <h3 style="color: #0891b2; font-size: 36px; margin: 0;">0</h3>
                            <span style="font-size: 12px; color: #6c757d;">Pending approval</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6 style="font-size: 13px;">Purchase Orders</h6>
                        <div class="d-flex align-items-center gap-3">
                            <h3 style="color: #0891b2; font-size: 36px; margin: 0;">0</h3>
                            <span style="font-size: 12px; color: #6c757d;">Pending my approval</span>
                        </div>
                        <div class="d-flex align-items-center gap-3 mt-3">
                            <h3 style="font-size: 24px; margin: 0;">0</h3>
                            <span style="font-size: 12px; color: #6c757d;">Pending approval</span>
                        </div>
                    </div>
                </div>
                
                <div class="notification-feed mt-4" style="border-top: 1px solid #dee2e6; padding-top: 15px;">
                    <h6 style="font-size: 13px; margin-bottom: 15px;">Notifications Feed</h6>
                    <div class="notification-item" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-circle text-primary" style="font-size: 8px;"></i>
                                <i class="fas fa-file-alt text-muted me-2"></i>
                                <strong>Activity due</strong> for rental application <strong>Katherine E. Mackenzie</strong>
                            </div>
                            <div class="text-muted">
                                <span>Status: Pending</span>
                                <span class="ms-3">08/07/2025</span>
                            </div>
                        </div>
                        <div style="margin-left: 30px; font-size: 11px; color: #6c757d;">Screen Application(s)</div>
                    </div>
                    <div class="notification-item" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-circle text-primary" style="font-size: 8px;"></i>
                                <i class="fas fa-file-alt text-muted me-2"></i>
                                <strong>Activity due</strong> for rental application <strong>Katherine E. Mackenzie</strong>
                            </div>
                            <div class="text-muted">
                                <span>Status: Pending</span>
                                <span class="ms-3">08/07/2025</span>
                            </div>
                        </div>
                        <div style="margin-left: 30px; font-size: 11px; color: #6c757d;">Collect Application Fee</div>
                    </div>
                    <div class="notification-item" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-circle text-primary" style="font-size: 8px;"></i>
                                <i class="fas fa-file-alt text-muted me-2"></i>
                                <strong>Activity due</strong> for rental application <strong>Katherine E. Mackenzie</strong>
                            </div>
                            <div class="text-muted">
                                <span>Status: Pending</span>
                                <span class="ms-3">08/07/2025</span>
                            </div>
                        </div>
                        <div style="margin-left: 30px; font-size: 11px; color: #6c757d;">Double check pay stubs, photo ID and all other documents submitted by the applicant(s)</div>
                    </div>
                    <div class="notification-item" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-circle text-muted" style="font-size: 8px;"></i>
                                <i class="fas fa-plus text-muted me-2"></i>
                                New <strong>rental application</strong> from Katherine E. Mackenzie
                            </div>
                            <div class="text-muted">
                                <span class="ms-3"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leasing Activity Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('leasingActivity')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Leasing Activity (Last 30 Days)</span>
            </div>
            <div id="leasingActivity" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="alert alert-info" style="background: #e8f4fd; border: 1px solid #bee5eb; font-size: 12px;">
                    <span class="badge bg-success">NEW</span> You reviewed 56 screening reports last month. Confirm applicants' ability to pay with <a href="#">Income Verification.</a>
                </div>
                
                <div class="row text-center">
                    <div class="col-md-6">
                        <h6 style="font-size: 13px; color: #6c757d;">Guest Cards</h6>
                        <canvas id="guestCardsChart" width="200" height="200"></canvas>
                        <h3 style="color: #0891b2; margin-top: 10px;">371</h3>
                        <p style="font-size: 11px; color: #6c757d;">TOTAL</p>
                    </div>
                    <div class="col-md-6">
                        <h6 style="font-size: 13px; color: #6c757d;">Rental Applications</h6>
                        <canvas id="rentalAppsChart" width="200" height="200"></canvas>
                        <h3 style="color: #0891b2; margin-top: 10px;">64</h3>
                        <p style="font-size: 11px; color: #6c757d;">TOTAL</p>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <h6 style="font-size: 13px; margin-bottom: 15px;">Online Leases</h6>
                        <div class="row text-center">
                            <div class="col-md-4">
                                <h3 style="color: #0891b2;">9</h3>
                                <p style="font-size: 11px; color: #6c757d;">Out for Signing</p>
                            </div>
                            <div class="col-md-4">
                                <h3 style="color: #0891b2;">2</h3>
                                <p style="font-size: 11px; color: #6c757d;">Ready to Countersign</p>
                            </div>
                            <div class="col-md-4">
                                <h3 style="color: #0891b2;">37</h3>
                                <p style="font-size: 11px; color: #6c757d;">Fully Executed</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <h6 style="font-size: 13px; margin-bottom: 15px;">Upcoming Lease Expirations</h6>
                        <div class="row text-center">
                            <div class="col-md-6">
                                <h3 style="color: #0891b2;">41</h3>
                                <p style="font-size: 11px; color: #6c757d;">Expiring This Month</p>
                            </div>
                            <div class="col-md-6">
                                <h3 style="color: #0891b2;">74</h3>
                                <p style="font-size: 11px; color: #6c757d;">Expiring Next Month</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <h6 style="font-size: 13px; margin-bottom: 15px;">Current Statistics</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h3 style="color: #0891b2;">36</h3>
                                    <span style="font-size: 11px; color: #6c757d;">Units Posted Online</span>
                                    <i class="fas fa-info-circle text-info"></i>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h3 style="color: #0891b2;">66 days</h3>
                                    <span style="font-size: 11px; color: #6c757d;">Average Turnover Time</span>
                                    <i class="fas fa-info-circle text-info"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Performance Metrics Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('keyMetrics')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Key Performance Metrics</span>
            </div>
            <div id="keyMetrics" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="row mb-3">
                    <div class="col-md-4 text-center">
                        <h3 style="color: #0891b2; font-size: 28px;">$842,569.29</h3>
                        <p style="font-size: 12px; color: #6c757d;">Total Income</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 style="color: #0891b2; font-size: 28px;">$231,078.74</h3>
                        <p style="font-size: 12px; color: #6c757d;">Total Expense</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 style="color: #0891b2; font-size: 28px;">$1,109,081.00</h3>
                        <p style="font-size: 12px; color: #6c757d;">Total Market Rent</p>
                    </div>
                </div>
                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="text-end mt-2">
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-chart-line"></i> GRAPH
                    </button>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-table"></i> TABLE
                    </button>
                </div>
            </div>
        </div>

        <!-- Portfolio Summary Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('portfolio')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Portfolio Summary</span>
            </div>
            <div id="portfolio" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="table-responsive">
                    <table class="table table-sm" style="font-size: 12px;">
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th></th>
                                <th>Beds</th>
                                <th>Units</th>
                                <th>Rented</th>
                                <th>Available <i class="fas fa-info-circle text-info"></i></th>
                                <th>Vacant Unrented</th>
                                <th>Avg Days Vacant</th>
                                <th>Move Ins</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #f8f9fa;">
                                <td></td>
                                <td>7</td>
                                <td>7</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0.00</td>
                                <td>0</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>56</td>
                                <td>47</td>
                                <td>11</td>
                                <td>9</td>
                                <td>80.44</td>
                                <td>2</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>307</td>
                                <td>278</td>
                                <td>40</td>
                                <td>29</td>
                                <td>254.52</td>
                                <td>7</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>749</td>
                                <td>699</td>
                                <td>71</td>
                                <td>50</td>
                                <td>109.42</td>
                                <td>10</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>94</td>
                                <td>87</td>
                                <td>9</td>
                                <td>7</td>
                                <td>231.43</td>
                                <td>1</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>1</td>
                                <td>1</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0.00</td>
                                <td>0</td>
                                <td></td>
                            </tr>
                            <tr style="font-weight: bold; background: #f8f9fa;">
                                <td></td>
                                <td>1214</td>
                                <td>1119</td>
                                <td>131</td>
                                <td>95</td>
                                <td></td>
                                <td>20</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Delinquencies Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('delinquencies')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Delinquencies</span>
            </div>
            <div id="delinquencies" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="delinquency-bar" style="display: flex; height: 40px; border-radius: 4px; overflow: hidden; margin-bottom: 20px;">
                    <div style="flex: 0 0 185px; background: #0891b2; display: flex; align-items: center; justify-content: center; color: white;">
                        <strong>185</strong>
                        <span style="margin-left: 10px; font-size: 11px;">0-30 DAYS</span>
                    </div>
                    <div style="flex: 0 0 31px; background: #f59e0b; display: flex; align-items: center; justify-content: center; color: white;">
                        <strong>31</strong>
                        <span style="margin-left: 5px; font-size: 10px;">31-60 DAYS</span>
                    </div>
                    <div style="flex: 0 0 110px; background: #ef4444; display: flex; align-items: center; justify-content: center; color: white;">
                        <strong>110</strong>
                        <span style="margin-left: 10px; font-size: 11px;">61+ DAYS</span>
                    </div>
                </div>
                <div class="alert alert-info" style="background: #d1ecf1; border: 1px solid #bee5eb; font-size: 12px;">
                    <i class="fas fa-info-circle"></i> You may have tenant delinquency that warrants eviction<br>
                    Visit the AIVIIZN Stack™ Marketplace to see partners in the Delinquencies category that can help streamline the <a href="#">Evictions</a> process.
                </div>
                <div class="mt-3">
                    <a href="#" style="font-size: 12px;">View Eligible Debt Summary</a><br>
                    <a href="#" style="font-size: 12px;">View Debt Collections Status</a><br>
                    <a href="#" style="font-size: 12px;">View All Delinquencies</a>
                </div>
            </div>
        </div>

        <!-- Vendor Online Payables Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('vendorPayables')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▶</span>
                <span class="fw-bold" style="font-size: 14px;">Vendor Online Payables</span>
            </div>
            <div id="vendorPayables" class="section-content" style="display: none; background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="alert alert-info" style="background: #d1ecf1; border: 1px solid #bee5eb; font-size: 12px;">
                    <i class="fas fa-info-circle"></i> You are currently not set up to take advantage of AIVIIZN's Payment Platform. To learn how this service can optimize your AIVIIZN investment <a href="#">click here.</a>
                </div>
            </div>
        </div>

        <!-- Maintenance Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('maintenance')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Maintenance</span>
            </div>
            <div id="maintenance" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <div class="alert alert-info" style="background: #d1ecf1; border: 1px solid #bee5eb; font-size: 12px;">
                    <i class="fas fa-info-circle"></i> Learn how Smart Maintenance can help you assign work orders 83% faster.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6 style="font-size: 13px; color: #6c757d; text-align: center;">Work Orders</h6>
                        <canvas id="workOrdersChart" width="250" height="250"></canvas>
                        <h3 style="text-align: center; color: #0891b2; margin-top: 10px;">1449</h3>
                        <p style="text-align: center; font-size: 11px; color: #6c757d;">TOTAL</p>
                    </div>
                    <div class="col-md-6">
                        <div class="work-order-stats" style="margin-top: 50px;">
                            <div class="stat-item mb-3">
                                <h3 style="color: #0891b2; display: inline;">220</h3>
                                <span style="margin-left: 10px; font-size: 12px;">New</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="color: #0891b2; display: inline;">122</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Assigned</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">0</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Estimate Requested</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">0</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Estimated</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">5</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Scheduled</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">15</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Waiting</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">21</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Work Done, Unbilled in Last 60 Days</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">0</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Ready to Bill</span>
                            </div>
                            <div class="stat-item">
                                <h3 style="display: inline;">1066</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Completed, Unbilled in Last 60 Days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insurance Coverage Section -->
        <div class="dashboard-section mb-4">
            <div class="section-header" onclick="toggleSection('insurance')" style="cursor: pointer; padding: 10px; background: white; border: 1px solid #dee2e6; border-radius: 4px;">
                <span class="section-arrow">▼</span>
                <span class="fw-bold" style="font-size: 14px;">Insurance Coverage</span>
                <select class="form-select form-select-sm float-end" style="width: 150px; display: inline;">
                    <option>By Tenant</option>
                    <option>By Property</option>
                </select>
            </div>
            <div id="insurance" class="section-content" style="background: white; border: 1px solid #dee2e6; border-top: none; padding: 20px;">
                <h6 style="font-size: 13px; color: #6c757d;">Tenant Insurance</h6>
                <div class="row">
                    <div class="col-md-6">
                        <canvas id="insuranceChart" width="250" height="250"></canvas>
                        <h3 style="text-align: center; color: #0891b2; margin-top: 10px;">1437</h3>
                        <p style="text-align: center; font-size: 11px; color: #6c757d;">TOTAL</p>
                    </div>
                    <div class="col-md-6">
                        <div class="insurance-stats" style="margin-top: 50px;">
                            <div class="stat-item mb-3">
                                <h3 style="color: #0891b2; display: inline;">501</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Renters Insurance</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="color: #0891b2; display: inline;">825</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Liability to Landlord Insurance</span>
                                <i class="fas fa-info-circle text-info"></i>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">0</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Both Renters and Liability to Landlord Insurance</span>
                            </div>
                            <div class="stat-item mb-3">
                                <h3 style="display: inline;">22</h3>
                                <span style="margin-left: 10px; font-size: 12px;">Policy Expiring in Next 30 Days</span>
                            </div>
                            <div class="stat-item">
                                <h3 style="display: inline;">105</h3>
                                <span style="margin-left: 10px; font-size: 12px;">No Insurance</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="coverage-percentages text-center mt-4" style="border-top: 1px solid #dee2e6; padding-top: 20px;">
                    <div class="row">
                        <div class="col-md-4">
                            <h4 style="color: #0891b2;">91.93%</h4>
                            <p style="font-size: 11px; color: #6c757d;">TOTAL COVERAGE</p>
                        </div>
                        <div class="col-md-4">
                            <h4 style="color: #0891b2;">34.86%</h4>
                            <p style="font-size: 11px; color: #6c757d;">RENTERS INSURANCE COVERAGE</p>
                        </div>
                        <div class="col-md-4">
                            <h4 style="color: #0891b2;">57.41%</h4>
                            <p style="font-size: 11px; color: #6c757d;">LIABILITY TO LANDLORD COVERAGE</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
/* Loading Skeleton Styles */
.skeleton-container {
    animation: pulse 1.5s ease-in-out infinite;
}

.skeleton-box {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s ease-in-out infinite;
    border-radius: 4px;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

/* Section Styles */
.dashboard-section {
    transition: all 0.3s ease;
}

.section-header {
    user-select: none;
    transition: background-color 0.2s;
}

.section-header:hover {
    background-color: #f8f9fa !important;
}

.section-arrow {
    display: inline-block;
    transition: transform 0.3s;
    margin-right: 10px;
}

.section-arrow.collapsed {
    transform: rotate(-90deg);
}

/* Table Styles */
.table-hover tbody tr:hover {
    background-color: #f8f9fa;
}

/* Badge Styles */
.badge {
    font-size: 10px;
    padding: 4px 8px;
    font-weight: normal;
}

/* Chart Legend Styles */
.chart-legend {
    list-style: none;
    padding: 0;
    margin: 10px 0;
}

.chart-legend li {
    display: inline-block;
    margin-right: 15px;
    font-size: 11px;
}

.chart-legend span {
    display: inline-block;
    width: 12px;
    height: 12px;
    margin-right: 5px;
    border-radius: 2px;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Lazy Loading Implementation
document.addEventListener('DOMContentLoaded', function() {
    // Show loading skeleton for 1.5 seconds, then fade in content
    setTimeout(function() {
        const skeleton = document.getElementById('loadingSkeleton');
        const content = document.getElementById('dashboardContent');
        
        skeleton.style.transition = 'opacity 0.5s';
        skeleton.style.opacity = '0';
        
        setTimeout(function() {
            skeleton.style.display = 'none';
            content.style.display = 'block';
            content.style.opacity = '0';
            content.style.transition = 'opacity 0.5s';
            
            setTimeout(function() {
                content.style.opacity = '1';
                initializeCharts();
            }, 50);
        }, 500);
    }, 1500);
});

// Toggle Section Function
function toggleSection(sectionId) {
    const content = document.getElementById(sectionId);
    const arrow = content.previousElementSibling.querySelector('.section-arrow');
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        arrow.textContent = '▼';
    } else {
        content.style.display = 'none';
        arrow.textContent = '▶';
    }
}

// Initialize Charts
function initializeCharts() {
    // Guest Cards Donut Chart
    const guestCardsCtx = document.getElementById('guestCardsChart');
    if (guestCardsCtx) {
        new Chart(guestCardsCtx, {
            type: 'doughnut',
            data: {
                labels: ['ACTIVE', 'PRE-QUALIFIED', 'INACTIVE', 'WAITLISTED', 'APPLICATION COMPLETED', 'COLD'],
                datasets: [{
                    data: [250, 30, 50, 20, 15, 6],
                    backgroundColor: ['#10b981', '#3b82f6', '#6b7280', '#f59e0b', '#06b6d4', '#e5e7eb']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Rental Applications Donut Chart
    const rentalAppsCtx = document.getElementById('rentalAppsChart');
    if (rentalAppsCtx) {
        new Chart(rentalAppsCtx, {
            type: 'doughnut',
            data: {
                labels: ['NEW', 'APPROVED', 'DENIED', 'DECISION PENDING', 'CANCELED'],
                datasets: [{
                    data: [5, 30, 10, 15, 4],
                    backgroundColor: ['#3b82f6', '#10b981', '#ef4444', '#f59e0b', '#6b7280']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Work Orders Donut Chart
    const workOrdersCtx = document.getElementById('workOrdersChart');
    if (workOrdersCtx) {
        new Chart(workOrdersCtx, {
            type: 'doughnut',
            data: {
                labels: ['NEW', 'ASSIGNED', 'ESTIMATE REQUESTED', 'ESTIMATED', 'SCHEDULED', 'WAITING', 'WORK DONE, UNBILLED', 'READY TO BILL', 'COMPLETED, UNBILLED'],
                datasets: [{
                    data: [220, 122, 0, 0, 5, 15, 21, 0, 1066],
                    backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#06b6d4', '#8b5cf6', '#ec4899', '#6b7280', '#dc2626', '#e5e7eb']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Insurance Coverage Donut Chart
    const insuranceCtx = document.getElementById('insuranceChart');
    if (insuranceCtx) {
        new Chart(insuranceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Renters Insurance', 'Liability to Landlord', 'No Insurance'],
                datasets: [{
                    data: [501, 825, 105],
                    backgroundColor: ['#10b981', '#3b82f6', '#ef4444']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Performance Line Chart
    const performanceCtx = document.getElementById('performanceChart');
    if (performanceCtx) {
        new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: ['Aug 2024', 'Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025', 'Mar 2025', 'Apr 2025', 'May 2025', 'Jun 2025', 'Jul 2025', 'Aug 2025'],
                datasets: [{
                    label: 'INCOME',
                    data: [1000000, 1020000, 1015000, 1030000, 1025000, 1040000, 1045000, 1055000, 1065000, 1070000, 1060000, 1040000, 842569],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.1
                }, {
                    label: 'EXPENSE',
                    data: [750000, 620000, 680000, 640000, 600000, 850000, 750000, 780000, 740000, 800000, 950000, 600000, 231078],
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + (value / 1000000).toFixed(1) + 'M';
                            }
                        }
                    }
                }
            }
        });
    }
}
</script>
{% endblock %}