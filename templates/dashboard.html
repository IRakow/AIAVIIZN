<!-- templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dashboard - AVIIZN{% endblock %}

{% block content %}
<div class="content-header">
    <h2>Dashboard</h2>
</div>

<div class="content-body">
    <!-- Move Ins Section -->
    <div class="dashboard-section mb-4">
        <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="fas fa-chevron-up text-muted me-2"></i>Move Ins</h5>
        </div>
        
        <div class="card">
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <strong>NEW</strong> Move Ins Updated
                    <p class="mb-0 small">We've added some key information to help track the progress of your move-ins. What additional information would you like to see?</p>
                    <button class="btn btn-sm btn-primary mt-2">FEEDBACK</button>
                </div>
                
                <div class="data-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Future Tenant</th>
                                <th>Property - Unit</th>
                                <th>Lease</th>
                                <th>Portal</th>
                                <th>Balance</th>
                                <th>Insurance</th>
                                <th>Move In Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for movein in recent_moveins %}
                            <tr>
                                <td>{{ movein.tenant }}</td>
                                <td>{{ movein.property }}</td>
                                <td><span class="badge bg-success">{{ movein.lease }}</span></td>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>${{ "%.2f"|format(movein.balance) }}</td>
                                <td>
                                    {% if movein.insurance == 'Covered' %}
                                        <span class="badge bg-success">Covered</span>
                                    {% else %}
                                        <span class="badge bg-warning">Not Covered</span>
                                    {% endif %}
                                </td>
                                <td>{{ movein.move_date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delinquencies Section -->
    <div class="dashboard-section mb-4">
        <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="fas fa-chevron-up text-muted me-2"></i>Delinquencies</h5>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="delinquency-bar d-flex" style="height: 60px;">
                    <div class="bar-segment" style="background-color: #4A90E2; width: 60%; display: flex; align-items: center; justify-content: center; color: white;">
                        <div>
                            <strong style="font-size: 24px;">{{ stats.delinquencies['0_30'] }}</strong><br>
                            <small>0-30 DAYS</small>
                        </div>
                    </div>
                    <div class="bar-segment" style="background-color: #FFA500; width: 20%; display: flex; align-items: center; justify-content: center; color: white;">
                        <div>
                            <strong style="font-size: 24px;">{{ stats.delinquencies['31_60'] }}</strong><br>
                            <small>31-60 DAYS</small>
                        </div>
                    </div>
                    <div class="bar-segment" style="background-color: #DC3545; width: 20%; display: flex; align-items: center; justify-content: center; color: white;">
                        <div>
                            <strong style="font-size: 24px;">{{ stats.delinquencies['61_plus'] }}</strong><br>
                            <small>61+ DAYS</small>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle"></i> You may have tenant delinquency that warrants eviction.
                    Visit the AppFolio Stackâ„¢ Marketplace to see partners in the Delinquencies category that can help streamline the <a href="#">Evictions</a> process.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Vendor Online Payables -->
    <div class="dashboard-section mb-4">
        <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="fas fa-chevron-up text-muted me-2"></i>Vendor Online Payables</h5>
        </div>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> You are currently not set up to take advantage of AppFolio's Payment Platform. To learn how this service can optimize your AppFolio investment <a href="#">click here</a>.
        </div>
    </div>
    
    <!-- Maintenance Section -->
    <div class="dashboard-section mb-4">
        <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="fas fa-chevron-up text-muted me-2"></i>Maintenance</h5>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h6>Work Orders</h6>
                        <div class="maintenance-chart">
                            <canvas id="workOrdersChart"></canvas>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span><strong>{{ stats.maintenance.work_orders.new }}</strong> New</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>{{ stats.maintenance.work_orders.assigned }}</strong> Assigned</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>0</strong> Estimate Requested</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>0</strong> Estimated</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>5</strong> Scheduled</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>15</strong> Waiting</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>21</strong> Work Done, Unbilled in Last 60 Days</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>0</strong> Ready to Bill</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>{{ stats.maintenance.work_orders.completed }}</strong> Completed, Unbilled in Last 60 Days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h6>Insurance Coverage</h6>
                        <div class="insurance-chart">
                            <canvas id="insuranceChart"></canvas>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span><strong>{{ stats.insurance.renters }}</strong> Renters Insurance</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>{{ stats.insurance.liability }}</strong> Liability to Landlord Insurance</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>0</strong> Both Renters and Liability to Landlord Insurance</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>22</strong> Policy Expiring in Next 30 Days</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><strong>105</strong> No Insurance</span>
                            </div>
                        </div>
                        
                        <div class="row mt-3 text-center">
                            <div class="col-4">
                                <h4>{{ stats.insurance.total_coverage }}</h4>
                                <small>TOTAL COVERAGE</small>
                            </div>
                            <div class="col-4">
                                <h4>34.86%</h4>
                                <small>RENTERS INSURANCE COVERAGE</small>
                            </div>
                            <div class="col-4">
                                <h4>57.41%</h4>
                                <small>LIABILITY TO LANDLORD COVERAGE</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Online Payments Section -->
    <div class="dashboard-section mb-4">
        <div class="section-header d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="fas fa-chevron-up text-muted me-2"></i>Online Payments</h5>
        </div>
        
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Online Payment Statistics</h6>
                        <div class="d-flex align-items-center">
                            <h1 class="mb-0 me-3">{{ stats.online_payments.percentage }}%</h1>
                            <span>Payments Collected Online</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h1 class="mb-0">{{ stats.online_payments.units_paid }}%</h1>
                        <span>Units Paid Online</span>
                    </div>
                </div>
                
                <p class="mt-3">Want to increase Online Payments? <a href="#">See who's not paying online</a></p>
                
                <div class="row mt-4">
                    <div class="col-md-4">
                        <h6>Online Portal Adoption</h6>
                        <div class="progress" style="height: 30px;">
                            <div class="progress-bar bg-success" style="width: 90%;">90% ACTIVATED</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 class="text-warning">5%</h4>
                            <small>NON-ACTIVATED</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 class="text-danger">5%</h4>
                            <small>NO EMAIL</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block contextsidebar %}
<!-- Dashboard Context Menu -->
<h5><i class="fas fa-tachometer-alt"></i> Dashboard</h5>
<div class="menu-item starred-item">Tasks</div>
<div class="menu-item">Customize Dashboard</div>
<div class="menu-item">View All Notifications</div>
<div class="menu-item">Export Dashboard</div>

<div class="task-section">
    <div class="task-section-title">Quick Stats</div>
    <div class="menu-item">Income Statement</div>
    <div class="menu-item">Balance Sheet</div>
    <div class="menu-item">Cash Flow</div>
    <div class="menu-item">Delinquency Report</div>
</div>

<div class="task-section">
    <div class="task-section-title">Shortcuts</div>
    <div class="menu-item">New Work Order</div>
    <div class="menu-item">New Lease</div>
    <div class="menu-item">Record Payment</div>
</div>
{% endblock %}

{% block taskssidebar %}
<!-- Dashboard Tasks Sidebar -->
<h5><i class="fas fa-tasks"></i> Tasks</h5>

<div class="task-item starred-item">Tasks</div>

<div class="task-section">
    <div class="task-section-title">Move Ins</div>
    <div class="task-item">Process Move In</div>
    <div class="task-item">Schedule Inspection</div>
    <div class="task-item">Update Insurance</div>
</div>

<div class="task-section">
    <div class="task-section-title">Delinquencies</div>
    <div class="task-item">Send Late Notices</div>
    <div class="task-item">Process Evictions</div>
    <div class="task-item">Payment Plans</div>
</div>

<div class="task-section">
    <div class="task-section-title">Maintenance</div>
    <div class="task-item">New Work Order</div>
    <div class="task-item">Assign Work Orders</div>
    <div class="task-item">Schedule Inspections</div>
    <div class="task-item">Order Supplies</div>
</div>

<div class="task-section">
    <div class="task-section-title">Financial</div>
    <div class="task-item">Record Payment</div>
    <div class="task-item">Enter Bill</div>
    <div class="task-item">Bank Reconciliation</div>
    <div class="task-item">Owner Distributions</div>
</div>

<div class="task-section">
    <div class="task-section-title">Reports</div>
    <div class="task-item">Daily Activity</div>
    <div class="task-item">Rent Roll</div>
    <div class="task-item">Vacancy Report</div>
    <div class="task-item">Income Statement</div>
</div>

<div class="support-section">
    <h5><i class="fas fa-life-ring"></i> Support</h5>
    <div class="task-item">Help Center</div>
    <div class="task-item">Contact Support</div>
    <div class="task-item">Training Videos</div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Work Orders Chart
const workOrdersCtx = document.getElementById('workOrdersChart');
if (workOrdersCtx) {
    new Chart(workOrdersCtx, {
        type: 'doughnut',
        data: {
            labels: ['New', 'Assigned', 'Estimate Requested', 'Estimated', 'Scheduled', 'Waiting', 'Work Done, Unbilled', 'Completed, Unbilled'],
            datasets: [{
                data: [220, 122, 0, 0, 5, 15, 21, 1066],
                backgroundColor: [
                    '#0B5394',
                    '#4A90E2',
                    '#FFC107',
                    '#28A745',
                    '#17A2B8',
                    '#6C757D',
                    '#DC3545',
                    '#28A745'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// Insurance Chart
const insuranceCtx = document.getElementById('insuranceChart');
if (insuranceCtx) {
    new Chart(insuranceCtx, {
        type: 'doughnut',
        data: {
            labels: ['Renters Insurance', 'Liability to Landlord', 'No Insurance'],
            datasets: [{
                data: [501, 825, 105],
                backgroundColor: [
                    '#28A745',
                    '#4A90E2',
                    '#DC3545'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}
</script>
{% endblock %}