{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block tabs %}
<a href="/dashboard" class="tab-nav-item active">Dashboard</a>
<a href="/vacancies" class="tab-nav-item">Vacancies</a>
<a href="/guest-cards" class="tab-nav-item">Guest Cards</a>
<a href="/rental-applications" class="tab-nav-item">Rental Applications</a>
<a href="/leases" class="tab-nav-item">Leases</a>
<a href="/renewals" class="tab-nav-item">Renewals</a>
<a href="/metrics" class="tab-nav-item">Metrics</a>
{% endblock %}

{% block content %}
<!-- Alert Box -->
{% if alerts %}
    {% for alert in alerts %}
    <div class="alert-box">
        <span>‚ÑπÔ∏è</span>
        <span>{{ alert.message }} 
        {% if alert.link %}<a href="{{ alert.link }}" style="color: #0056b3;">Click here</a>{% endif %}
        {% if alert.dismissible %}
        | <a href="#" onclick="dismissAlert('{{ alert.id }}')" style="color: #0056b3;">Remind me in 7 days</a> 
        | <a href="#" onclick="dismissAlert('{{ alert.id }}', true)" style="color: #0056b3;">Don't show this message again</a>
        {% endif %}
        </span>
    </div>
    {% endfor %}
{% endif %}

<!-- Feedback Section -->
<div style="background-color: white; padding: 15px; border-radius: 4px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <button class="btn btn-info" style="float: right;">üìß FEEDBACK</button>
    <h2 style="color: #28a745; font-size: 16px; margin-bottom: 10px;">NEW - Move Ins Updated</h2>
    <p style="font-size: 14px; color: #495057;">We've added some key information to help track the progress of your move-ins. What additional information would you like to see?</p>
    <div style="clear: both;"></div>
</div>

<!-- Filter Section -->
<div class="filter-section">
    <form method="get" action="/dashboard">
        <div class="filter-row">
            <input type="text" name="search" placeholder="Search by property, unit or group" value="{{ request.args.get('search', '') }}">
            <select name="status">
                <option value="">Lease Status</option>
                <option value="active" {% if request.args.get('status') == 'active' %}selected{% endif %}>Active</option>
                <option value="pending" {% if request.args.get('status') == 'pending' %}selected{% endif %}>Pending</option>
                <option value="executed" {% if request.args.get('status') == 'executed' %}selected{% endif %}>Executed</option>
            </select>
            <button type="submit" class="btn btn-primary">Search</button>
            <label style="display: flex; align-items: center; gap: 5px; margin-left: 10px;">
                <input type="checkbox" name="show_finished" {% if request.args.get('show_finished') %}checked{% endif %}>
                <span style="font-size: 13px;">Show Finished Move Ins</span>
            </label>
        </div>
    </form>
</div>

<!-- Data Table -->
<div class="data-table">
    <table>
        <thead>
            <tr>
                <th>Future Tenant <span style="font-size: 10px;">‚Üï</span></th>
                <th>Property - Unit <span style="font-size: 10px;">‚Üï</span></th>
                <th>Lease <span style="font-size: 10px;">‚Üï</span></th>
                <th>Portal <span style="font-size: 10px;">‚Üï</span></th>
                <th>Balance <span style="font-size: 10px;">‚Üï</span></th>
                <th>Insurance</th>
                <th>Move In Date <span style="font-size: 10px;">‚Üï</span></th>
            </tr>
        </thead>
        <tbody>
            {% if move_ins %}
                {% for move_in in move_ins %}
                <tr>
                    <td>{{ move_in.tenants.last_name }}, {{ move_in.tenants.first_name }}</td>
                    <td>{{ move_in.units.properties.name }} - {{ move_in.units.unit_number }}</td>
                    <td>
                        {% if move_in.lease_status == 'executed' %}
                            <span class="status-executed">Fully Executed</span>
                        {% elif move_in.lease_status == 'pending' %}
                            Out for Signing
                        {% else %}
                            Ready to Countersign
                        {% endif %}
                    </td>
                    <td><span class="status-active">{{ move_in.portal_status|capitalize }}</span></td>
                    <td>${{ "%.2f"|format(move_in.balance) }}</td>
                    <td>
                        {% if move_in.insurance_status == 'covered' %}
                            <span style="background: #d4edda; color: #155724; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Covered</span>
                        {% elif move_in.insurance_status == 'pending' %}
                            <span style="background: #d1ecf1; color: #0c5460; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Pending</span>
                        {% else %}
                            <span style="background: #fff3cd; color: #856404; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Not Covered</span>
                        {% endif %}
                    </td>
                    <td>{{ move_in.move_in_date.strftime('%m/%d/%Y') if move_in.move_in_date else '-' }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <!-- Sample data for demo -->
                <tr>
                    <td>Sainge, Samuel</td>
                    <td>Campbell Apartments - 3403 #4</td>
                    <td>Ready to Countersign</td>
                    <td><span class="status-active">Active</span></td>
                    <td>$400.00</td>
                    <td><span style="background: #fff3cd; color: #856404; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Not Covered</span></td>
                    <td>07/25/2025</td>
                </tr>
                <tr>
                    <td>Bell, Telia R.</td>
                    <td>Villas of Mur-Len - 205 U</td>
                    <td>Out for Signing</td>
                    <td><span class="status-active">Active</span></td>
                    <td>$0.00</td>
                    <td><span style="background: #fff3cd; color: #856404; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Not Covered</span></td>
                    <td>08/01/2025</td>
                </tr>
                <tr>
                    <td>Carlson, Eric A.</td>
                    <td>Campbell Apartments - 3403 #4</td>
                    <td><span class="status-executed">Fully Executed</span></td>
                    <td><span class="status-active">Active</span></td>
                    <td>-$727.74</td>
                    <td><span style="background: #d4edda; color: #155724; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">Covered</span></td>
                    <td>08/08/2025</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block tasks_panel %}
<div class="tasks-panel" id="tasksPanel">
    <div class="tasks-header">
        <h3>Tasks</h3>
        <button class="close-btn" onclick="toggleTasksPanel()">√ó</button>
    </div>
    <div class="tasks-content">
        <div class="task-section-title">‚≠ê Tasks</div>
        <div class="task-item">Create Vacancies List</div>
        <div class="task-item">New Rental Application</div>
        <div class="task-item">New Guest Card</div>
        <div class="task-item">Lease Templates</div>
        <div class="task-item">Bulk Update Vacancy Posting Contact Info</div>
        
        <div class="task-section-title">üìä Reports</div>
        <div class="task-item">Unit Vacancy Detail</div>
        <div class="task-item">Rental Applications</div>
        <div class="task-item">Guest Card Interests</div>
        <div class="task-item">Owner Leasing</div>
        <div class="task-item">Premium Listing Billing Detail</div>
        
        <div class="task-section-title">‚ùì Help Topics</div>
        <div class="task-item">Post & Unpost Vacancies</div>
        <div class="task-item">Marketing Campaigns</div>
        <div class="task-item">Premium Listing</div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function dismissAlert(alertId, permanent = false) {
    fetch('/api/alerts/dismiss', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            alert_id: alertId,
            permanent: permanent
        })
    }).then(response => {
        if (response.ok) {
            location.reload();
        }
    });
}
</script>
{% endblock %}